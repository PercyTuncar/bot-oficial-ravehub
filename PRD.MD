crea un bot para whatsapp  usando baileys, debes estrcturar los archivos , debes usar solo javascript ES6 , debes usar firebase.
la estructura de archivos debe ser facil de escalar es decir se de poder agregar nuevos comandos facilmente.

se subira a ES2 de AWS se debe usar PM2 para mantenrlo activo 24/7, debe tener buenas practicas para que no se crashee debe ser todo asincorono debe tener un flujo perfecto desde la ejecicion hasta la respuesta.

debe tener las sigueintes funcionalidads:

se arranca el bot se muestra por la terminal el qr para leerlo desde el telefono y vincular el bot con un numero, el boto debe poder ejecutar sus propios comandos, no debe ser ignorado , al vincular correctamnte el bot manda un DM a su propio privado indicando que se ha conectado exitosamente y todo los detalles del server.

para activar el bot dentro de un grupo se debe hacer de la siguiente forma:
en el dm del mismo bot el mismo bot  debe mandar el comando .listgroups y se mostrara una lista con todo los grupos donde pertenece el bot y se peude activar , respuesta debe ser ordenado el nombre del grupo su Identificador numero de participantes etc cada grupo por semarado, despues en el mismo DM el bot debe enviar .bot on id_del_grupo y   debe responder el bot en el mismo DM se esta activando el grupo, despues se debe editar ese misma respuesta a cargando 0 a 100% de 10 en 10 y finalmente una ultima actulizada donde diga que el bot se ha activado y ya se peude usar ene se grupo.
para apagar el bot dentro del grupos se debe ejecutar .bot off id_del_grupo  , despues dentro de los grupos debe existir 4 niveles de permismos el priemero el bot pordra ejecutar absolutamnte todo los comandos, el segundo son los admis pordran ejecutar comandos de admin , los terceros son los comandos premium que tienen permiso para que algunos numeros tengan acceso a ciertos comandos que son premiums, los otros que son comandos para que cualquier participante pueda ejecutar.
IMPRTANTE: 
cuando se crea un grupo en la base de datos se debe crear el grupo como coleccion principal y dentro sus documentos y subcolecciones que sea necesario apra cumplir con todo lo que se pide, tambien dentro tendra su configuracion del grupo donde se podra configurar las bienvenidas , despedidas para ese grupo, etc. 


IMPORTANTE:
En la base de datos se debe guardar los siguientes datos de todo los integrantes cuando interactuan por primera vez, si un usuario manda un mensje por primera vez se debe crear el usuario en la base de datos con todo sus metadaros unicos para poder identificarlo, este usuario tendra su ID, numero de telefono real, su nombre que tiene configurado en sus ajustes de su whtasapp, la cantidad de mensjes que ha enviado en el grupo (por ejemplo si manda un mensje por primera  vez  en el grupo se debe crear al usario en la abse de datos con el contado de mensajes que debe iniciar en 1 porque acaba de enviar su primer mensje y tambien se debe mandar el contenido de su mensje, en el caso de que ya haya enviado mensjes anteriormete entoces solo se debe actualizar el coantador de mensajes  y se debe seguri sus mensjes si el mensaje contiene a una mencion a un usuario tambien se debe guardar dentro de ese mensje que ha mencionado a un usuario (identificando al usaurio mencioando con sus datos como nombre telefono real y ID) ), tambien se debe  guardar su historial de warns y el motivo, su histial de kicks y el motivo, la hora de la ultima vez que mando un mensaje , cuantos dias tiene activo en el grupo , su fecha de cumpleanios, su nivel sube de nivel cada cierta cantidad de mensejes enviados, dinero (para ganar dinero debe enviar mensjes) cada mensje enviado debe ser equivalente a $0.01 centavos, si manda 10 mensjes entonces tendra $0.10 centavos, si manda 100 mensaje entonces tendra $1 USD,  debe tener esa logica debe mostrar centavos y si ya es $1 entones debe decir dolares. 
IMPORTANTE DEL SITEMA DE ECONOMIA: cada $0.50 centavos  recien se le debe pagar al usuario es decir si un usuairo manda 1 mensje solo acumula 0.01 centavo pero no sera transfirido al usaurio aun , solo se le paga cada que el usuario acumule $0.50, el sitema paga al usuario dinero en efectivo al usuario  para proteger el dinero pagado el usuario debe ejecutar el comando .deposit (.deposit {cantidad} con alias .depositar {cantiad} .dep {cantidad}, .dep all o .depositar todo para depositar todo )   

 PARA SUBIR DE NIVEL SE DEBE BASAR EN EL DINERO SI TIENE MENOS DE 10 USD ENTONCES ES NIVEL 1, SI TIENE EN TRE 10 Y 20 ENTOCNES ES DE NIVEL 2 Y ASI SUCESIVAMENTE, Y CADA NIVEL TAMBIEN DEBE TENER UN NOMBRE 0 - 10 USD: Youtube (Lo ves desde tu casa, no te alcanzÃ³).

10 - 20 USD: Vereda (Escuchando desde la calle, tomando trago corto).

20 - 30 USD: Reja (Apurando la entrada, pero todavÃ­a afuera).

30 - 40 USD: Tribuna (Adentro, pero lo ves chiquitito y de lejos).

40 - 50 USD: General (En el pogo, apretado y sudando).

50 - 60 USD: Preferencial (Un poquito mÃ¡s cerca, pero igual parado).

60 - 70 USD: VIP (Ya tienes pulsera, te sientes especial).

70 - 80 USD: SuperVIP (Barra libre y baÃ±o limpio).

80 - 90 USD: Backstage (Te codeas con los dueÃ±os y staff).

90 - 100 USD: Booth (En la cabina, al lado del DJ).

> 100 USD: Headliner (TÃº eres la estrella, todos te miran).

CADA QUE UN USUARIIO SUBE O BAJA DE NIVEL SE LE DEBE MANDAR UN MENSJE POR EJEMPLO SI SUBE A NIVEL 2 SE LE NOTIFICA AL SUARIO:
@USUARIO SUBISTE A NIVEL 2, ZONA REJA, eres una perosona que ve desde la reja aun no te alcanza para entrar.
si sube a nivel 3 entonces el mensaje sera: @USUARIO SUBISTE A NIVEL 3, ZONA tribuna, ya puedes entrar pero lo ves desde lejos... y asi sucesivamente.

cuando baja de nivel tambien se le debe notificar mencioandolo , solo baja de nivel cada que gasta su dinero o le roban, El nivel debe basarse en el Patrimonio Neto (Net Worth), que es Dinero en Mano + Dinero en Banco. 

OJO: la cantidad de mensjes importa para subir de nivel por ejemplo si un usuario manda 100 mensjes tendra 1 usd , pero si gasta ese 1 usd debe seguir manteniendo la cantidad de mensjes que es 100, si llega a tener 200 mensjes de neuvo tendra 1 USD, debes aplicar esa logica para que de forma consitente se siga sumando el dinero despues de gastar, es muy importante crear una logica consitente para que esto funcione.


debe existir los siguientes comandos:
.ping puede ejecutar el mismo bot y admins los demas no deben tener acceso a este comando, la respuesta debe ser pong la latencia y estado del servidor.

el comando .me puede ser ejecutado por cualquiera y mostrara su informacion del usario que ha consultado como : foto de perfil cantidad de mensjes , warns,  la cantidad de dinero, SU nivel: nivel 1 y su descripcion del nivel, etc todo lo que este usuario tenga en la base de datos.

el comando .info @usuario tambien debe poder ser ejecutado por todos , pero esto es muy importnate si un usuario hace .info @usaurio y menciona a un usuario que nunca ha interactuado mandando un mensje por lo tanto este usuario mencioando no esta registrado en la base de datos se el debe mostrar un mensje diciendole que el usario aun no esta activo en el chat, si el usuario mencionado ya ha participado mandando un mensje entonces se supone que ya esta en la base de datos y ahora si se mostrara toda la info de ese usario mencionado similar al .me pero con los datos del usuario emncionado.

comando .rob este comando debe ser ejecutado el bot, admins y por todos los usuarios  usuarios de nivel 2 en adelante , se usa de la sigueinte forma: .rob @usuario o con su alias  .robar @usuario, el sitema debe hacer lo sigueinte identifica al usario mencionado en la base de datos busca la cantitdad de dinero que tiene , si tiene 0 entocnes respondera "@usuario No tiene dinero" , si tiene dinero debe existir una probailidad de 30% robo existoso y se debe robar aleatoriamente cualquier cantidad que tenga el usuario por ejmplo si el usuario victima tiene 2 USD y le quieren robar y sale exitoso puede robarle  todo o solo 0.01 centavo, si roba todo el mensje debe ser dejaste en banca rota a @usuario, si roba entre 0 y 10% de su riqueza le debe responder el bot cuanto en procentaje y cantidad  se ha robando de ese usario y le debe decir que tu robo fue casi frustrado, si le roba entre 10 y 20% entocnes le debe mostrar la cantidad robada y tambien le debe mostran un mensje "este fue un robo novato" si le roba entre 20 y 50% entocnes le debe mostrar la cantidad tambien y le mensje debe decir Buen robo, y asi sucesivamente, si se roba el 100% que sera pcoo probable pero no 0% de probalibidad entoces le DIRA ROBO EXITOSO ERES UN MAESTRO ROBASTE 100% A @USUARIO Y LE DEJASTE EN BANCA ROTA... pero tambien debe existir una probabilidad de 50% que el robo falle y se le debe decir : Robo fallido te atrapo la polcia y te multo con {cantida} de dolares y se le pago a @usuario victima por danios y prejuicios, si la multa al ladron es alta mayor a lo que tiene en su patrimonio entonces debe tener una deuda su dinero debe ser negativo y debe enviar mas mensjes para que obtenga dinero y todo el dinero obtenido se le debe pagar a la victiva hasta saldar su deuda y recien sumara el dinero al ladron cuando no tenga dedas penales por pagar.  SOLO SE DEBE PODER ROBAR DINERO EN EFECTIVO QUE EL USARIO TENGA Y no ha guardado en su banco , en caso de las multas al ladron se debe quitar dinero que tengan en su banco y en la amno se debe hacer como una intervencion bancaria y a sus bolsillos para pagar la deuda y si no cuenta con el monto para pagar sudeuda sumanod su banco y bolsillo entonces Generas Deuda Negativa y sus futuros mensajes pagan esa deuda.

El comando .shop debe mostrar el inventario de la tienda que debe ser un JSON por ejmplo los productos deben tener su nombre descripcion precio etc.
ejemplo:  1 . CERVEZA  precio $25 descripcion: "Reclama una cerveza en el proximo festival que asistira ravehub"
2. STIKER PRECIO $15 reclama 1 stikcer a tu eleccion  en el siguiente festibval que asistira ravehub.
3. POLO ravehub precio $85 reclama un polo oficial de ravehub en nuestro proximo festival que asistira ravehub. 
para comprar usa .buy numero_de_item


el comando .buy item , este comando crea un pedido de la tienda (se debe validadr si el suario cuenta con el dinero suficiente para generar el pedido), si es validado todo entocnes se debe gernar el pedido para que los admis puedan verlo y queda en estado de pendiente de entrega.
Identificadores de Pedido (Order ID): Cada vez que alguien compre con .buy item, el sistema debe generar un cÃ³digo corto Ãºnico (ej: #ORD-001). AsÃ­ el admin gestiona por cÃ³digo y no por nombre de usuario (que puede cambiar).


el comando  .requests (o .pedidos): debe ser usado solo por admins, FunciÃ³n: Muestra una lista solo de los pedidos con estado PENDING. Formato: [#ORD-05] @usuario - Cerveza ($25) - Hace 10 min.

el comando .deliver <ID_PEDIDO> (o .entregar): 
FunciÃ³n: Marca el pedido como DELIVERED en la base de datos y le avisa al usuario: "âœ… @usuario Tu pedido #ORD-05 ha sido entregado. Â¡DisfrÃºtalo!".
.reject <ID_PEDIDO> (o .rechazar):

FunciÃ³n: Marca el pedido como REJECTED.

LÃ³gica de Reembolso: CRÃTICO. El sistema debe tomar el precio del producto y devolverlo automÃ¡ticamente al BANCO del usuario (para que no se lo roben apenas se lo devuelvan). Le envÃ­a un mensaje: "âŒ Tu pedido #ORD-05 fue rechazado. Se te reembolsaron $25 a tu cuenta bancaria".


. Sistema de Bienvenidas (.welcome):

Comando .welcome on: Activa las bienvenidas en el grupo.

Comando .welcome off: Desactiva.

Comando .welcome message [texto]: Guarda el mensaje personalizado.

Placeholders: El bot debe reemplazar dinÃ¡micamente:

{user}: MenciÃ³n (@) al usuario que entra.

{group}: Nombre del grupo.

{members}: Cantidad total de participantes.

DetecciÃ³n de ImÃ¡genes (IMPORTANTE):

Si el texto configurado contiene una URL directa de imagen (terminada en .png, .jpg, .jpeg), el bot debe detectar esa URL.

AcciÃ³n: Descargar la imagen de la URL y enviar el mensaje como tipo IMAGEN (attachment) poniendo el resto del texto como descripciÃ³n (caption).

Si no hay URL de imagen, enviar como texto normal.

Debe respetar saltos de lÃ­nea, negritas y emojis del texto original.


Sistema de ModeraciÃ³n:
LÃ³gica de IdentificaciÃ³n de Objetivo y Motivo (ComÃºn para Warn y Kick)
El bot debe ser capaz de identificar al usuario y el motivo de dos formas:

MenciÃ³n Directa: .comando @usuario Motivo manual.

Respuesta (Reply): Si se responde a un mensaje de un usuario con .comando (con o sin motivo extra).

Algoritmo de Prioridad para el Motivo:

Prioridad 1 (Texto explÃ­cito): Si el admin escribe texto despuÃ©s del comando (ej: .warn @user Spam), ese es el motivo.

Prioridad 2 (Contenido del mensaje respondido): Si el admin NO escribe texto, pero estÃ¡ respondiendo a un mensaje, el contenido de ese mensaje original se convierte automÃ¡ticamente en el motivo.

Ejemplo: Un usuario envÃ­a "Hijo de puta". El admin responde a ese mensaje solo con .warn.

Resultado: El motivo guardado en base de datos serÃ¡: "Hijo de puta".

Prioridad 3 (Default): Si no hay texto ni respuesta, el motivo es "Sin motivo especificado".

B. Comando .warn (Advertencia)
Flujo de EjecuciÃ³n:

Lectura: Consultar en BD cuÃ¡ntas advertencias tiene el usuario actualmente.

Incremento: Sumar +1 al contador y guardar el nuevo historial (Motivo, Admin que sancionÃ³, Fecha).

VerificaciÃ³n de LÃ­mite (3 Warns):

Caso A (Warns < 3):

Guardar cambios en BD.

Responder: "âš ï¸ @usuario ha sido advertido. Motivo: [X]. Advertencias: [N]/3".

Caso B (Warns >= 3):

Guardar cambios en BD.

Responder: "ğŸš« @usuario ha superado el lÃ­mite de 3 advertencias. Expulsando...".

Ejecutar ExpulsiÃ³n: El bot elimina al usuario del grupo inmediatamente.

(Opcional) Resetear contador de warns a 0 tras la expulsiÃ³n automÃ¡tica.

C. Comando .kick (ExpulsiÃ³n)
Flujo de EjecuciÃ³n:

Registro: Guardar en el historial del usuario en BD que fue expulsado (Motivo, Admin, Fecha) para tener antecedentes futuros.

EjecuciÃ³n: Enviar la orden a Baileys para remover al participante del grupo (groupParticipantsUpdate -> remove).

Respuesta: Enviar mensaje al grupo: "se va, se va... se fue! @usuario expulsado. Motivo: [Motivo Detectado]".


JUEGOS:
para jugar se debe hacer los iguiente priemro se debe usar dinero en efectivo (dinero en mano) si su dinero en mano es 0 entocnes se le debe indicar que debe retirar deinero de su banco ".retirar cantidad" si no tiene dinero en el banco au usar .retirar entoces se le mostrar un mensaje que no tiene dinero. y si tiene se debe poder jugar los siguientes juegos desde $1, lo ganado se paga en su mano y debe depositarlo para que su dinero este seguro , si pierde obviamente se debe descontar: 


ğŸ’¡ Idea 1: La Tragaperras (Slots) ğŸ°
El juego mÃ¡s visual. El usuario apuesta y ve cÃ³mo giran los emojis.

Comando: .slot [cantidad]

Probabilidad:

3 Iguales (7ï¸âƒ£7ï¸âƒ£7ï¸âƒ£): x10 (Muy difÃ­cil - 5%)

2 Iguales (ğŸ’ğŸ’â“): x1.5 (Medio - 30%)

Diferentes: Pierde (65%)

Flujo de AnimaciÃ³n (EdiciÃ³n de Mensaje):

Usuario: .slot 10

Bot (Mensaje inicial):

Plaintext

ğŸ° CASINO RAVEHUB ğŸ°
---------------------
| ğŸŸ© | ğŸŸ© | ğŸŸ© |
---------------------
GIRANDO...
Bot (Edita a los 1s):

Plaintext

ğŸ° CASINO RAVEHUB ğŸ°
---------------------
| ğŸ’ | ğŸŸ© | ğŸŸ© |
---------------------
...
Bot (Edita a los 2s):

Plaintext

ğŸ° CASINO RAVEHUB ğŸ°
---------------------
| ğŸ’ | ğŸ’ | ğŸŸ© |
---------------------
...
Bot (Final - Resultado):

Plaintext

ğŸ° CASINO RAVEHUB ğŸ°
---------------------
| ğŸ’ | ğŸ’ | ğŸ‹ |
---------------------
Â¡Casi! Tienes par de cerezas.
Ganaste: $15 (x1.5)
Se depositÃ³ en tu mano. ğŸ’µ
ğŸ’¡ Idea 2: Cara o Cruz (Coinflip) ğŸª™
Simple, rÃ¡pido y adictivo. 50/50.

Comando: .flip [cantidad] [cara/cruz]

Probabilidad: 50% ganar, 50% perder.

Pago: x1.95 (El 0.05 es la comisiÃ³n de la casa para evitar inflaciÃ³n).

Flujo de AnimaciÃ³n:

Usuario: .flip 5 cara

Bot (Inicial): "Tirando la moneda... ğŸ¤œğŸª™"

Bot (Edita 1s): "La moneda estÃ¡ en el aire... â˜ï¸ğŸª™â˜ï¸"

Bot (Final): "Resultaod: CARA ğŸ¤´. Â¡Ganaste $9.75!"

ğŸ’¡ Idea 3: Dados (Dice/High-Low) ğŸ²
Apostar si la suma de dos dados serÃ¡ mayor o menor a 7.

Comando: .dados [cantidad] [mas/menos] (MÃ¡s de 7 o Menos de 7).

Pago: x2. (Si sale exactamente 7, la casa gana, esa es la ventaja del bot).

Flujo de AnimaciÃ³n:

Usuario: .dados 20 mas

Bot (Inicial): "Agitando el cubilete... ğŸ¥¤"

Bot (Edita 1s): "Tirando dados... ğŸ² ğŸ²"

Bot (Final): "Dados: [ âš„ ] [ âš… ] = 11. Â¡Apostaste MÃS y saliÃ³ 11! Ganaste $40."

A. Tragamonedas (.slot [cantidad])
Descuento: Restar la apuesta de wallet inmediatamente.

AnimaciÃ³n (EdiciÃ³n):

Enviar mensaje: "ğŸ° | ğŸŸ© | ğŸŸ© | ğŸŸ© | Girando..."

Esperar 1s, editar: "ğŸ° | ğŸ’ | ğŸŸ© | ğŸŸ© | ..."

Esperar 1s, editar: "ğŸ° | ğŸ’ | ğŸ’ | â“ | ..."

Esperar 1s, editar Resultado Final.

LÃ³gica: Generar 3 items aleatorios (ğŸ’, ğŸ‹, ğŸ‡, ğŸ’, 7ï¸âƒ£).

3 Iguales (Jackpot): Paga x10.

2 Iguales: Paga x1.5.

Diferentes: No paga (PÃ©rdida total).

Pago: Si gana, sumar premio a wallet y avisar: "Ganaste $[monto] en efectivo".

B. Cara o Cruz (.flip [cant] [cara/cruz])
Descuento: Restar apuesta.

AnimaciÃ³n:

Enviar: "Lanzando moneda... ğŸ¤œğŸª™"

Editar (1s): "Girando en el aire... ğŸŒ€"

Editar (1s): Resultado Final ("CayÃ³: CARA ğŸ¤´").

LÃ³gica: 50% probabilidad.

Pago: Si acierta, paga x1.95 (La casa se queda 5%).

C. Dados (.dice [cant] [mas/menos])
Apuesta a si la suma de 2 dados es Mayor (mas) o Menor (menos) a 7.

El nÃºmero 7 es la Casa: Si la suma es exactamente 7, el usuario pierde siempre.

AnimaciÃ³n: "ğŸ² Agitando..." -> "ğŸ² Rodando..." -> "ğŸ² [4] [1] = 5".

Pago: Si acierta, paga x2.

# Sistema Completo de Bot WhatsApp con Baileys y Firebase

## Stack TecnolÃ³gico
- **LibrerÃ­a:** Baileys (WhiskeySockets/Baileys) - Ãšltima versiÃ³n estable
- **Lenguaje:** JavaScript ES6 (Node.js 17+)
- **Base de Datos:** Firebase Firestore
- **Servidor:** AWS EC2
- **Gestor de Procesos:** PM2 (daemon mode 24/7)
- **Arquitectura:** AsÃ­ncrona, event-driven, modular y escalable

---

## Arquitectura del Proyecto

### Estructura de Archivos (Modular y Escalable)

```
whatsapp-bot/
â”œâ”€â”€ index.js                    # Punto de entrada principal
â”œâ”€â”€ package.json
â”œâ”€â”€ ecosystem.config.js         # ConfiguraciÃ³n PM2
â”œâ”€â”€ .env                        # Variables de entorno
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ firebase.js         # InicializaciÃ³n Firebase
â”‚   â”‚   â””â”€â”€ baileys.js          # ConfiguraciÃ³n Baileys
â”‚   â”‚
â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”œâ”€â”€ connection.js       # Manejo de conexiÃ³n/QR
â”‚   â”‚   â”œâ”€â”€ messages.js         # Handler principal de mensajes
â”‚   â”‚   â””â”€â”€ groups.js           # Handler de eventos de grupos
â”‚   â”‚
â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â”œâ”€â”€ index.js            # Registry de comandos
â”‚   â”‚   â”œâ”€â”€ admin/              # Comandos de administraciÃ³n
â”‚   â”‚   â”‚   â”œâ”€â”€ ping.js
â”‚   â”‚   â”‚   â”œâ”€â”€ listgroups.js
â”‚   â”‚   â”‚   â”œâ”€â”€ botcontrol.js
â”‚   â”‚   â”‚   â”œâ”€â”€ warn.js
â”‚   â”‚   â”‚   â”œâ”€â”€ kick.js
â”‚   â”‚   â”‚   â”œâ”€â”€ deliver.js
â”‚   â”‚   â”‚   â””â”€â”€ reject.js
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ user/               # Comandos para usuarios
â”‚   â”‚   â”‚   â”œâ”€â”€ me.js
â”‚   â”‚   â”‚   â”œâ”€â”€ info.js
â”‚   â”‚   â”‚   â”œâ”€â”€ rob.js
â”‚   â”‚   â”‚   â””â”€â”€ shop.js
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ economy/            # Sistema econÃ³mico
â”‚   â”‚   â”‚   â”œâ”€â”€ deposit.js
â”‚   â”‚   â”‚   â”œâ”€â”€ withdraw.js
â”‚   â”‚   â”‚   â””â”€â”€ buy.js
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ games/              # Juegos de casino
â”‚   â”‚   â”‚   â”œâ”€â”€ slot.js
â”‚   â”‚   â”‚   â”œâ”€â”€ coinflip.js
â”‚   â”‚   â”‚   â””â”€â”€ dice.js
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ moderation/         # Sistema de bienvenidas
â”‚   â”‚       â””â”€â”€ welcome.js
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ database.js         # Operaciones Firestore
â”‚   â”‚   â”œâ”€â”€ economy.js          # LÃ³gica econÃ³mica
â”‚   â”‚   â”œâ”€â”€ levels.js           # Sistema de niveles
â”‚   â”‚   â”œâ”€â”€ permissions.js      # Control de permisos
â”‚   â”‚   â””â”€â”€ shop.js             # GestiÃ³n de tienda
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ logger.js           # Sistema de logs
â”‚   â”‚   â”œâ”€â”€ validators.js       # Validaciones
â”‚   â”‚   â””â”€â”€ formatters.js       # Formatos de mensajes
â”‚   â”‚
â”‚   â””â”€â”€ middleware/
â”‚       â”œâ”€â”€ anticrash.js        # Manejo de errores global
â”‚       â”œâ”€â”€ ratelimit.js        # Rate limiting
â”‚       â””â”€â”€ groupcheck.js       # Verificar grupo activo
â”‚
â””â”€â”€ auth_info/                  # SesiÃ³n Baileys (persistente)
```

---

## Flujo de InicializaciÃ³n del Bot

### 1. Arranque y AutenticaciÃ³n

**Comando de inicio:**
```bash
pm2 start ecosystem.config.js
```

**Flujo esperado:**

```
[SISTEMA] Iniciando bot WhatsApp...
[BAILEYS] Cargando sesiÃ³n de autenticaciÃ³n...
[BAILEYS] No hay sesiÃ³n previa detectada
[QR] Escanea este cÃ³digo QR desde tu WhatsApp:

â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆâ–ˆâ–ˆâ–ˆ â–„â–„â–„â–„â–„ â–ˆâ–€â–ˆ â–ˆâ–„â–„â–ˆ â–„â–„â–„â–„â–„ â–ˆâ–ˆâ–ˆâ–ˆ
â–ˆâ–ˆâ–ˆâ–ˆ â–ˆ   â–ˆ â–ˆâ–€â–€â–€â–ˆ â–€â–ˆ â–ˆ   â–ˆ â–ˆâ–ˆâ–ˆâ–ˆ
â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–„â–„â–„â–ˆ â–ˆâ–€ â–ˆâ–€â–€ â–ˆ â–ˆâ–„â–„â–„â–ˆ â–ˆâ–ˆâ–ˆâ–ˆ
...

[QR] Tienes 60 segundos para vincular el dispositivo
```

**Al vincular exitosamente:**
```
[BAILEYS] âœ“ ConexiÃ³n establecida con WhatsApp
[BAILEYS] âœ“ SesiÃ³n guardada en /auth_info
[BOT] Enviando mensaje de confirmaciÃ³n al DM propio...
```

**Mensaje automÃ¡tico al DM del bot:**
```
ğŸ¤– BOT CONECTADO EXITOSAMENTE

ğŸ“Š Detalles del servidor:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ–¥ï¸ Servidor: AWS EC2 (us-east-1)
âš¡ Proceso: PM2 (ID: 0)
ğŸ”„ Estado: ONLINE
ğŸ“¶ Latencia: 45ms
â° Conectado: 24/12/2024 - 15:32:10
ğŸ’¾ Memoria: 128MB / 1GB
ğŸ”¥ Firebase: Conectado
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… El bot estÃ¡ listo para usarse.
Usa .listgroups para ver grupos disponibles.
```

---

## Sistema de Control del Bot en Grupos

### Comando: `.listgroups`
**Permisos:** Solo ejecutable por el bot en su propio DM  
**Alias:** `.listargrupos`, `.grupos`

**EjecuciÃ³n:**
```
Usuario (Bot): .listgroups
```

**Respuesta esperada:**
```
ğŸ“‹ GRUPOS DISPONIBLES

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1ï¸âƒ£ RaveHub Community
ğŸ“Œ ID: 120363025@g.us
ğŸ‘¥ Participantes: 247
ğŸ¤– Estado: INACTIVO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2ï¸âƒ£ Festival Squad 2024
ğŸ“Œ ID: 120363189@g.us
ğŸ‘¥ Participantes: 89
ğŸ¤– Estado: ACTIVO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
3ï¸âƒ£ Techno Lovers Chile
ğŸ“Œ ID: 120363267@g.us
ğŸ‘¥ Participantes: 156
ğŸ¤– Estado: INACTIVO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’¡ Usa: .bot on <ID> para activar
ğŸ’¡ Usa: .bot off <ID> para desactivar
```

### Comando: `.bot on <id_grupo>`
**Permisos:** Solo ejecutable por el bot en su propio DM  
**Alias:** `.activar <id>`

**EjecuciÃ³n:**
```
Usuario (Bot): .bot on 120363025@g.us
```

**Respuesta con animaciÃ³n (ediciÃ³n de mensaje):**

**Mensaje 1 (inmediato):**
```
ğŸ”„ Activando bot en: RaveHub Community
```

**Mensaje editado cada 500ms:**
```
â³ Cargando sistema... [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘] 10%
```
```
â³ Cargando sistema... [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 80%
```

**Mensaje final:**
```
âœ… BOT ACTIVADO EXITOSAMENTE

ğŸ“ Grupo: RaveHub Community
ğŸ†” ID: 120363025@g.us
ğŸ‘¥ Participantes: 247
â° Activado: 24/12/2024 - 15:45:30
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
El bot ya puede responder comandos en este grupo.
```

**AcciÃ³n en Firebase:**
```javascript
// Estructura creada en Firestore
groups/
  â””â”€â”€ 120363025@g.us/
      â”œâ”€â”€ active: true
      â”œâ”€â”€ name: "RaveHub Community"
      â”œâ”€â”€ participants: 247
      â”œâ”€â”€ activatedAt: Timestamp(2024-12-24T15:45:30)
      â”œâ”€â”€ settings/
      â”‚   â”œâ”€â”€ welcome: {enabled: false, message: "", imageUrl: ""}
      â”‚   â”œâ”€â”€ farewell: {enabled: false, message: ""}
      â”‚   â””â”€â”€ antilink: false
      â”œâ”€â”€ members/ (subcolecciÃ³n)
      â””â”€â”€ economy/ (subcolecciÃ³n)
```

### Comando: `.bot off <id_grupo>`
**Permisos:** Solo bot en su DM  

**EjecuciÃ³n:**
```
Usuario (Bot): .bot off 120363025@g.us
```

**Respuesta:**
```
ğŸ”´ BOT DESACTIVADO

ğŸ“ Grupo: RaveHub Community
ğŸ†” ID: 120363025@g.us
â° Desactivado: 24/12/2024 - 16:20:15
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
El bot ignorarÃ¡ comandos en este grupo hasta reactivarlo.
```

---

## Sistema de Permisos (4 Niveles)

### Nivel 1: Bot Owner (Permisos Absolutos)
- **IdentificaciÃ³n:** NÃºmero del bot registrado
- **Acceso:** Todos los comandos sin restricciÃ³n
- **Comandos exclusivos:** `.ping`, `.bot on/off`, `.listgroups`

### Nivel 2: Administradores de Grupo
- **IdentificaciÃ³n:** Verificado mediante `groupMetadata.participants` (admin=true)
- **Comandos permitidos:**
  - `.warn`, `.kick`, `.welcome`, `.deliver`, `.reject`, `.requests`
  - Comandos de moderaciÃ³n y gestiÃ³n de pedidos

### Nivel 3: Usuarios Premium
- **IdentificaciÃ³n:** Lista almacenada en Firebase (`groups/{groupId}/premiumUsers`)
- **Comandos permitidos:**
  - Comandos especiales definidos por admins
  - Acceso prioritario a funciones avanzadas

### Nivel 4: Usuarios Regulares
- **Acceso:** Comandos bÃ¡sicos pÃºblicos
- **Comandos permitidos:**
  - `.me`, `.info`, `.rob`, `.shop`, `.buy`, `.deposit`, `.withdraw`
  - Juegos de casino (`.slot`, `.flip`, `.dice`)

**ValidaciÃ³n de permisos en cada comando:**
```javascript
// Ejemplo de flujo
async function handleCommand(message, command) {
  const userLevel = await getPermissionLevel(message.sender);
  const requiredLevel = commandRegistry[command].requiredLevel;
  
  if (userLevel < requiredLevel) {
    return sendMessage(message.chat, "âŒ No tienes permiso para este comando.");
  }
  
  // Ejecutar comando...
}
```

---

## Sistema de Usuarios y Base de Datos

### CreaciÃ³n AutomÃ¡tica de Usuario (Primera InteracciÃ³n)

**Trigger:** Usuario envÃ­a primer mensaje en un grupo activo

**Datos capturados:**
```javascript
users/
  â””â”€â”€ 51987654321/ // NÃºmero sin @ pero con cÃ³digo paÃ­s
      â”œâ”€â”€ id: "51987654321"
      â”œâ”€â”€ phone: "+51 987 654 321"
      â”œâ”€â”€ name: "Diego Ramirez" // Nombre de WhatsApp
      â”œâ”€â”€ joinedAt: Timestamp
      â”œâ”€â”€ lastMessage: Timestamp
      â”œâ”€â”€ activeDays: 1
      â”œâ”€â”€ birthday: null
      â”œâ”€â”€ totalMessages: 1
      â”œâ”€â”€ wallet: 0.01 // Dinero en mano
      â”œâ”€â”€ bank: 0 // Dinero en banco
      â”œâ”€â”€ pending: 0 // Dinero acumulado sin pagar
      â”œâ”€â”€ level: 1
      â”œâ”€â”€ levelName: "Youtube"
      â”œâ”€â”€ warns: []
      â”œâ”€â”€ kicks: []
      â””â”€â”€ messages/ (subcolecciÃ³n)
          â””â”€â”€ {messageId}/
              â”œâ”€â”€ content: "Hola grupo!"
              â”œâ”€â”€ timestamp: Timestamp
              â”œâ”€â”€ mentions: ["51912345678"] // IDs mencionados
              â””â”€â”€ replied_to: null
```

**Proceso paso a paso:**

1. **Verificar si usuario existe en BD**
   - Si no existe â†’ Crear documento con datos iniciales
   - Si existe â†’ Actualizar `totalMessages` y agregar mensaje a subcolecciÃ³n

2. **Registro del mensaje**
   ```javascript
   // Guardar cada mensaje enviado
   await db.collection('users').doc(userId).collection('messages').add({
     content: messageText,
     timestamp: new Date(),
     mentions: extractMentions(message),
     repliedTo: message.quoted ? message.quoted.sender : null
   });
   ```

3. **Actualizar contador de mensajes**
   ```javascript
   await db.collection('users').doc(userId).update({
     totalMessages: FieldValue.increment(1),
     lastMessage: new Date(),
     pending: FieldValue.increment(0.01)
   });
   ```

---

## Sistema EconÃ³mico

### MecÃ¡nica de Ganancia de Dinero

**Regla base:**  
1 mensaje = $0.01 USD

**Sistema de pago diferido:**
- El dinero se **acumula** en `pending` hasta llegar a **$0.50**
- Al alcanzar $0.50 â†’ Se transfiere automÃ¡ticamente a `wallet` (dinero en mano)
- NotificaciÃ³n al usuario cuando recibe el pago

**Ejemplo de flujo:**

```
Usuario envÃ­a mensaje #1:
  totalMessages: 1
  pending: 0.01
  wallet: 0
  â†’ Sin pago aÃºn

Usuario envÃ­a mensaje #50:
  totalMessages: 50
  pending: 0.50
  wallet: 0
  â†’ Â¡Pago automÃ¡tico!
  
[SISTEMA] Transfiere 0.50 a wallet
  pending: 0
  wallet: 0.50
  
[BOT NOTIFICA]:
ğŸ’° Â¡PAGO RECIBIDO!
Has recibido $0.50 en efectivo.
ğŸ’¡ Usa .deposit 0.50 para guardarlo en el banco.
```

### ProtecciÃ³n de Dinero: Sistema Bancario

**Dinero en mano vs Dinero en banco:**
- **Wallet (mano):** Vulnerable a robos, usado para juegos
- **Bank (banco):** Protegido, no puede ser robado

**Comando: `.deposit <cantidad>`**  
**Alias:** `.depositar`, `.dep`  
**Uso especial:** `.dep all` o `.depositar todo`

**Ejemplo de uso:**
```
Usuario: .deposit 5.00
```
**Respuesta:**
```
ğŸ’³ DEPÃ“SITO EXITOSO

ğŸ’µ Cantidad: $5.00
ğŸ¦ Banco: $5.00 â†’ $10.00
ğŸ’° Efectivo: $7.50 â†’ $2.50
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… Tu dinero estÃ¡ protegido.
```

**Comando: `.withdraw <cantidad>`**  
**Alias:** `.retirar`, `.sacar`

**Ejemplo:**
```
Usuario: .withdraw 3.00
```
**Respuesta:**
```
ğŸ§ RETIRO EXITOSO

ğŸ’µ Cantidad: $3.00
ğŸ¦ Banco: $10.00 â†’ $7.00
ğŸ’° Efectivo: $2.50 â†’ $5.50
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¡ Recuerda: El efectivo puede ser robado.
```

---

## Sistema de Niveles

### CÃ¡lculo del Nivel (Basado en Patrimonio Neto)

**FÃ³rmula:**
```
Patrimonio Neto = wallet + bank
```

**Tabla de Niveles:**

| Rango USD | Nivel | Nombre | DescripciÃ³n |
|-----------|-------|--------|-------------|
| 0 - 10 | 1 | Youtube | Lo ves desde tu casa, no te alcanzÃ³ |
| 10 - 20 | 2 | Vereda | Escuchando desde la calle, tomando trago corto |
| 20 - 30 | 3 | Reja | Apurando la entrada, pero todavÃ­a afuera |
| 30 - 40 | 4 | Tribuna | Adentro, pero lo ves chiquitito y de lejos |
| 40 - 50 | 5 | General | En el pogo, apretado y sudando |
| 50 - 60 | 6 | Preferencial | Un poquito mÃ¡s cerca, pero igual parado |
| 60 - 70 | 7 | VIP | Ya tienes pulsera, te sientes especial |
| 70 - 80 | 8 | SuperVIP | Barra libre y baÃ±o limpio |
| 80 - 90 | 9 | Backstage | Te codeas con los dueÃ±os y staff |
| 90 - 100 | 10 | Booth | En la cabina, al lado del DJ |
| > 100 | 11 | Headliner | TÃº eres la estrella, todos te miran |

### Notificaciones de Subida/Bajada de Nivel

**Ejemplo - Usuario sube a nivel 3:**
```
ğŸ‰ Â¡SUBISTE DE NIVEL!

@Usuario subiste a NIVEL 3
ğŸ« ZONA: REJA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘€ Eres una persona que ve desde la reja.
AÃºn no te alcanza para entrar, pero ya estÃ¡s cerca.

ğŸ’° Patrimonio: $23.50
ğŸ“Š Mensajes enviados: 1,235
```

**Ejemplo - Usuario baja a nivel 2:**
```
âš ï¸ BAJASTE DE NIVEL

@Usuario bajaste a NIVEL 2
ğŸº ZONA: VEREDA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‰ Escuchando desde la calle, tomando trago corto.
Has perdido dinero, Â¡recupera tu posiciÃ³n!

ğŸ’¸ Patrimonio: $15.80
ğŸ’° Necesitas: $4.20 mÃ¡s para volver a Reja
```

### Consistencia del Sistema de Mensajes

**Problema a resolver:**  
Usuario tiene 100 mensajes ($1.00) â†’ Gasta $1.00 â†’ Debe seguir progresando

**SoluciÃ³n implementada:**
```javascript
// No resetear totalMessages al gastar dinero
// Solo usar totalMessages para tracking de actividad
// El dinero se calcula independientemente:

Usuario:
  totalMessages: 100 (nunca decrece)
  wallet: 0 (gastÃ³ todo)
  pending: 0

// EnvÃ­a 100 mensajes mÃ¡s:
  totalMessages: 200
  pending: 1.00
  // Al llegar a 0.50 pending:
  wallet: 1.00 (nuevo pago)
```

---

## Comandos de Usuario

### Comando: `.ping`
**Permisos:** Bot Owner, Admins  
**Alias:** Ninguno

**EjecuciÃ³n:**
```
Admin: .ping
```

**Respuesta:**
```
ğŸ“ PONG!

âš¡ Latencia: 42ms
ğŸ–¥ï¸ Servidor: AWS EC2
ğŸ”¥ Firebase: 18ms
ğŸ’š Estado: ONLINE
â° Uptime: 12h 34m 18s
ğŸ’¾ Memoria: 156MB / 1GB
```

### Comando: `.me`
**Permisos:** Todos los usuarios  
**Alias:** `.perfil`, `.yo`

**EjecuciÃ³n:**
```
Usuario: .me
```

**Respuesta:**
```
ğŸ‘¤ PERFIL DE USUARIO

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“› Nombre: Diego RamÃ­rez
ğŸ“ TelÃ©fono: +51 987 654 321
ğŸ†” ID: 51987654321
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’° ECONOMÃA
ğŸ’µ Efectivo: $12.45
ğŸ¦ Banco: $87.30
ğŸ’ Patrimonio: $99.75
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š ESTADÃSTICAS
âœ‰ï¸ Mensajes: 2,473
ğŸ‚ CumpleaÃ±os: 15/08
ğŸ“… DÃ­as activo: 127
â° Ãšltimo mensaje: Hace 3m
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ NIVEL
ğŸ”° Nivel 10: Booth
ğŸµ En la cabina, al lado del DJ
ğŸ“ˆ PrÃ³ximo nivel: $0.25 mÃ¡s
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ INFRACCIONES
Advertencias: 1/3
Expulsiones: 0
```

### Comando: `.info @usuario`
**Permisos:** Todos los usuarios  
**Alias:** `.perfil @usuario`, `.ver @usuario`

**EjecuciÃ³n:**
```
Usuario: .info @51912345678
```

**Respuesta si el usuario NO existe:**
```
âŒ USUARIO NO REGISTRADO

@Usuario aÃºn no ha interactuado en este grupo.
Debe enviar al menos 1 mensaje para registrarse.
```

**Respuesta si el usuario existe:**
```
ğŸ‘¤ PERFIL DE @CarlosMendez

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“› Nombre: Carlos Mendez
ğŸ“ TelÃ©fono: +51 912 345 678
ğŸ†” ID: 51912345678
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’° ECONOMÃA
ğŸ’µ Efectivo: $3.20
ğŸ¦ Banco: $45.80
ğŸ’ Patrimonio: $49.00
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š ESTADÃSTICAS
âœ‰ï¸ Mensajes: 820
ğŸ‚ CumpleaÃ±os: No configurado
ğŸ“… DÃ­as activo: 45
â° Ãšltimo mensaje: Hace 1h
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ NIVEL
ğŸ”° Nivel 5: General
ğŸ¸ En el pogo, apretado y sudando
ğŸ“ˆ PrÃ³ximo nivel: $1.00 mÃ¡s
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ INFRACCIONES
Advertencias: 0/3
Expulsiones: 0
```

---

## Sistema de Robos

### Comando: `.rob @usuario`
**Permisos:** Bot, Admins, Usuarios de nivel 2 o superior  
**Alias:** `.robar @usuario`, `.steal @usuario`

### MecÃ¡nica del Robo

**Condiciones:**
- El ladrÃ³n debe ser nivel 2 o superior
- Solo se roba dinero en **wallet** (efectivo)
- El dinero del banco NO puede ser robado

**Probabilidades:**
- 30% â†’ Robo exitoso
- 50% â†’ Robo fallido (multa)
- 20% â†’ Robo frustrado (sin consecuencias)

**Cantidad robada (si es exitoso):**
- Aleatoria entre 1% y 100% del efectivo de la vÃ­ctima

### Ejemplos de Uso

**Caso 1: VÃ­ctima sin dinero**
```
LadrÃ³n: .rob @51987654321

Bot responde:
ğŸ’¼ @Diego no tiene dinero en efectivo.
No hay nada que robar.
```

**Caso 2: Robo exitoso (baja cantidad)**
```
LadrÃ³n: .rob @51987654321

[SISTEMA CALCULA]
- VÃ­ctima tiene: $10.00 en wallet
- Probabilidad: 30% â†’ Ã‰xito
- Cantidad robada: $0.80 (8%)

Bot responde:
ğŸ¥· ROBO CASI FRUSTRADO

Robaste $0.80 (8%) a @Diego
ğŸ’° Tu efectivo: $5.00 â†’ $5.80
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ Â¡Ese fue un robo novato!
Por poco te atrapan.
```

**Caso 3: Robo exitoso (cantidad media)**
```
LadrÃ³n: .rob @51987654321

[SISTEMA]
- VÃ­ctima: $10.00
- Robado: $3.50 (35%)

Bot:
ğŸ’° BUEN ROBO

Robaste $3.50 (35%) a @Diego
ğŸ’µ Tu efectivo: $5.00 â†’ $8.50
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘ Robo decente, nada mal.
```

**Caso 4: Robo perfecto (100%)**
```
LadrÃ³n: .rob @51987654321

[SISTEMA]
- VÃ­ctima: $10.00
- Robado: $10.00 (100%)

Bot:
ğŸ‰ Â¡ROBO PERFECTO!

ğŸ’ ERES UN MAESTRO DEL CRIMEN ğŸ’
Robaste $10.00 (100%) a @Diego
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’€ DEJASTE EN BANCA ROTA A @Diego
ğŸ’° Tu efectivo: $5.00 â†’ $15.00
```

**Caso 5: Robo fallido - Multa baja**
```
LadrÃ³n: .rob @51987654321

[SISTEMA]
- Probabilidad: 50% â†’ Fallo
- Multa: $2.00 (aleatoria)
- LadrÃ³n tiene: wallet $1.50, bank $5.00

Bot:
ğŸš¨ ROBO FALLIDO

âŒ TE ATRAPÃ“ LA POLICÃA
ğŸ’¸ Multa: $2.00 pagados a @Diego
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Tu efectivo: $1.50 â†’ $0.00
Tu banco: $5.00 â†’ $4.50
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš–ï¸ Se tomÃ³ dinero de tu banco.
@Diego recibiÃ³ $2.00 como compensaciÃ³n.
```

**Caso 6: Robo fallido - Deuda generada**
```
LadrÃ³n: .rob @51987654321

[SISTEMA]
- Multa: $8.00
- LadrÃ³n tiene: wallet $1.00, bank $3.00
- Total disponible: $4.00
- Deuda generada: $4.00

Bot:
ğŸš¨ ROBO FALLIDO - DEUDA GENERADA

âŒ TE ATRAPÃ“ LA POLICÃA
ğŸ’¸ Multa: $8.00 a @Diego
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š INTERVENCIÃ“N BANCARIA
Efectivo: $1.00 â†’ $0.00
Banco: $3.00 â†’ $0.00
ğŸ’³ Deuda pendiente: -$4.00
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ NO PUDISTE PAGAR LA MULTA COMPLETA
Tus prÃ³ximos mensajes pagarÃ¡n esta deuda.
@Diego recibiÃ³ $4.00 (resto pendiente).
```

**Sistema de pago de deuda:**
```javascript
// Usuario con deuda: -$4.00
// EnvÃ­a 100 mensajes = $1.00 generado

[SISTEMA]
- pending: $1.00
- Se destina a pagar deuda: -$4.00 â†’ -$3.00
- wallet: $0 (no recibe dinero aÃºn)

// Usuario sigue enviando mensajes...
// Deuda se salda completamente
- pending: $4.00 acumulado
- Deuda: -$4.00 â†’ $0.00
- wallet: $0.00 (nada extra)

// PrÃ³ximo mensaje:
- pending: $0.01
- wallet: $0.01 (ahora sÃ­ recibe dinero)
```

---

## Sistema de Tienda

### Estructura del Inventario (JSON en Firebase)

```javascript
shop/ (colecciÃ³n)
  â””â”€â”€ inventory/ (documento)
      â””â”€â”€ items: [
        {
          id: 1,
          name: "Cerveza",
          description: "Reclama una cerveza en el prÃ³ximo festival que asistirÃ¡ RaveHub",
          price: 25.00,
          category: "bebidas",
          available: true,
          stock: 50
        },
        {
          id: 2,
          name: "Sticker",
          description: "Reclama 1 sticker a tu elecciÃ³n en el siguiente festival que asistirÃ¡ RaveHub",
          price: 15.00,
          category: "merchandising",
          available: true,
          stock: 100
        },
        {
          id: 3,
          name: "Polo RaveHub",
          description: "Reclama un polo oficial de RaveHub en nuestro prÃ³ximo festival",
          price: 85.00,
          category: "ropa",
          available: true,
          stock: 30
        }
      ]
```

### Comando: `.shop`
**Permisos:** Todos los usuarios  
**Alias:** `.tienda`, `.store`

**EjecuciÃ³n:**
```
Usuario: .shop
```

**Respuesta:**
```
ğŸ›’ TIENDA RAVEHUB

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1ï¸âƒ£ CERVEZA
ğŸ’µ Precio: $25.00
ğŸ“¦ Stock: 50 unidades
ğŸ“ Reclama una cerveza en el prÃ³ximo
   festival que asistirÃ¡ RaveHub.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2ï¸âƒ£ STICKER
ğŸ’µ Precio: $15.00
ğŸ“¦ Stock: 100 unidades
ğŸ“ Reclama 1 sticker a tu elecciÃ³n
   en el siguiente festival.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
3ï¸âƒ£ POLO RAVEHUB
ğŸ’µ Precio: $85.00
ğŸ“¦ Stock: 30 unidades
ğŸ“ Reclama un polo oficial de RaveHub
   en nuestro prÃ³ximo festival.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’¡ Para comprar: .buy <nÃºmero>
   Ejemplo: .buy 1
```

### Comando: `.buy <nÃºmero_item>`
**Permisos:** Todos los usuarios  
**Alias:** `.comprar <nÃºmero>`, `.purchase <nÃºmero>`

**Validaciones:**
1. Usuario tiene suficiente dinero en banco
2. Item existe y estÃ¡ disponible
3. Hay stock disponible

**EjecuciÃ³n exitosa:**
```
Usuario: .buy 1

[SISTEMA VALIDA]
- Item #1 existe: âœ“
- Precio: $25.00
- Usuario bank: $87.30 âœ“
- Stock disponible: 50 â†’ 49 âœ“
- Genera Order ID: #ORD-001

Bot responde:
âœ… COMPRA EXITOSA

ğŸ›ï¸ Producto: Cerveza
ğŸ’° Precio: $25.00
ğŸ†” Pedido: #ORD-001
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’³ MOVIMIENTO BANCARIO
Banco: $87.30 â†’ $62.30
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ Estado: PENDIENTE DE ENTREGA
â° Creado: 24/12/2024 - 16:45:30

ğŸ”” SerÃ¡s notificado cuando los admins
   procesen tu pedido.
```

**EjecuciÃ³n con error (sin fondos):**
```
Usuario: .buy 3

[SISTEMA]
- Precio: $85.00
- Usuario bank: $62.30 âŒ

Bot:
âŒ FONDOS INSUFICIENTES

ğŸ›ï¸ Producto: Polo RaveHub
ğŸ’° Precio: $85.00
ğŸ¦ Tu banco: $62.30
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âŒ Te faltan: $22.70

ğŸ’¡ EnvÃ­a mÃ¡s mensajes para ganar dinero
   o usa .deposit para guardar tu efectivo.
```

### Sistema de Pedidos en Firebase

```javascript
orders/ (colecciÃ³n)
  â””â”€â”€ ORD-001/ (documento)
      â”œâ”€â”€ orderId: "ORD-001"
      â”œâ”€â”€ userId: "51987654321"
      â”œâ”€â”€ userName: "Diego RamÃ­rez"
      â”œâ”€â”€ userPhone: "+51 987 654 321"
      â”œâ”€â”€ itemId: 1
      â”œâ”€â”€ itemName: "Cerveza"
      â”œâ”€â”€ price: 25.00
      â”œâ”€â”€ status: "PENDING" // PENDING, DELIVERED, REJECTED
      â”œâ”€â”€ createdAt: Timestamp
      â”œâ”€â”€ deliveredAt: null
      â”œâ”€â”€ rejectedAt: null
      â”œâ”€â”€ handledBy: null // Admin que procesÃ³
      â””â”€â”€ groupId: "120363025@g.us"
```

---

## Comandos de GestiÃ³n de Pedidos (Admins)

### Comando: `.requests`
**Permisos:** Administradores  
**Alias:** `.pedidos`, `.orders`

**EjecuciÃ³n:**
```
Admin: .requests
```

**Respuesta:**
```
ğŸ“‹ PEDIDOS PENDIENTES

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ†” #ORD-001
ğŸ‘¤ @Diego (+51 987 654 321)
ğŸ›ï¸ Cerveza
ğŸ’° $25.00
â° Hace 10 minutos
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ†” #ORD-002
ğŸ‘¤ @Carlos (+51 912 345 678)
ğŸ›ï¸ Sticker
ğŸ’° $15.00
â° Hace 1 hora
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ†” #ORD-003
ğŸ‘¤ @Maria (+51 998 765 432)
ğŸ›ï¸ Polo RaveHub
ğŸ’° $85.00
â° Hace 3 horas
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Total: 3 pedidos pendientes

ğŸ’¡ Usa:
.deliver <ID> para marcar como entregado
.reject <ID> para rechazar y reembolsar
```

**Si no hay pedidos:**
```
ğŸ“‹ PEDIDOS PENDIENTES

âœ… No hay pedidos pendientes.
Todos los pedidos han sido procesados.
```

### Comando: `.deliver <order_id>`
**Permisos:** Administradores  
**Alias:** `.entregar <order_id>`, `.complete <order_id>`

**EjecuciÃ³n:**
```
Admin: .deliver ORD-001

[SISTEMA]
- Busca pedido ORD-001
- Valida estado = PENDING âœ“
- Actualiza status â†’ DELIVERED
- Registra admin y timestamp

Bot responde al admin:
âœ… PEDIDO ENTREGADO

ğŸ†” Pedido: #ORD-001
ğŸ‘¤ Cliente: @Diego
ğŸ›ï¸ Producto: Cerveza
ğŸ’° Valor: $25.00
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¦ Marcado como ENTREGADO
ğŸ‘¨â€ğŸ’¼ Procesado por: @Admin
â° 24/12/2024 - 17:30:45

Bot notifica al usuario:
âœ… TU PEDIDO HA SIDO ENTREGADO

ğŸ†” Pedido: #ORD-001
ğŸ›ï¸ Producto: Cerveza
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‰ Â¡DisfrÃºtalo en el festival!
Nos vemos en el prÃ³ximo evento de RaveHub.
```

### Comando: `.reject <order_id>`
**Permisos:** Administradores  
**Alias:** `.rechazar <order_id>`, `.cancel <order_id>`

**EjecuciÃ³n:**
```
Admin: .reject ORD-002

[SISTEMA]
- Busca pedido ORD-002
- Valida estado = PENDING âœ“
- Actualiza status â†’ REJECTED
- Reembolso: $15.00 â†’ bank del usuario
- Registra admin y timestamp

Bot responde al admin:
âŒ PEDIDO RECHAZADO

ğŸ†” Pedido: #ORD-002
ğŸ‘¤ Cliente: @Carlos
ğŸ›ï¸ Producto: Sticker
ğŸ’° Valor: $15.00
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âŒ Marcado como RECHAZADO
ğŸ’¸ Reembolso: $15.00 â†’ Banco
ğŸ‘¨â€ğŸ’¼ Procesado por: @Admin
â° 24/12/2024 - 17:35:20

Bot notifica al usuario:
âŒ TU PEDIDO FUE RECHAZADO

ğŸ†” Pedido: #ORD-002
ğŸ›ï¸ Producto: Sticker
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’³ REEMBOLSO PROCESADO
Se reembolsaron $15.00 a tu banco.
ğŸ¦ Banco: $45.80 â†’ $60.80
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“§ Contacta a un admin para mÃ¡s informaciÃ³n.
```

---

## Sistema de Bienvenidas

### ConfiguraciÃ³n del Mensaje de Bienvenida

**Comando: `.welcome on`**  
**Permisos:** Administradores  
**EjecuciÃ³n:**
```
Admin: .welcome on

Bot:
âœ… Bienvenidas activadas en este grupo.
ğŸ’¡ Configura el mensaje con:
.welcome message [tu mensaje]
```

**Comando: `.welcome off`**  
**Permisos:** Administradores  
**EjecuciÃ³n:**
```
Admin: .welcome off

Bot:
âŒ Bienvenidas desactivadas en este grupo.
```

**Comando: `.welcome message <texto>`**  
**Permisos:** Administradores  

**EjecuciÃ³n con placeholders:**
```
Admin: .welcome message Â¡Bienvenido {user} a {group}! ğŸ‰

Somos {members} miembros en esta comunidad.

Reglas:
1. Respeta a todos
2. No spam
3. Disfruta la mÃºsica

Bot:
âœ… Mensaje de bienvenida configurado.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Vista previa:

Â¡Bienvenido @NuevoUsuario a RaveHub Community! ğŸ‰

Somos 248 miembros en esta comunidad.

Reglas:
1. Respeta a todos
2. No spam
3. Disfruta la mÃºsica
```

### Bienvenida con Imagen

**EjecuciÃ³n:**
```
Admin: .welcome message https://i.imgur.com/festival2024.jpg

Â¡Bienvenido {user} a {group}! ğŸ‰
Festival Season 2024 ğŸµ

Bot detecta URL de imagen (.jpg/.png/.jpeg)

Bot:
âœ… Mensaje con imagen configurado.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ–¼ï¸ Imagen detectada: festival2024.jpg
ğŸ“ Texto: Configurado con placeholders
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¡ Las bienvenidas se enviarÃ¡n como imagen
   con el texto como descripciÃ³n.
```

**Cuando un nuevo usuario se une:**
```
[SISTEMA DETECTA NUEVO PARTICIPANTE]
- Grupo activo: âœ“
- Bienvenidas activadas: âœ“
- Descarga imagen desde URL
- Reemplaza placeholders:
  {user} â†’ @NuevoUsuario
  {group} â†’ RaveHub Community
  {members} â†’ 249

Bot envÃ­a:
[IMAGEN: festival2024.jpg]
Caption:
Â¡Bienvenido @NuevoUsuario a RaveHub Community! ğŸ‰
Festival Season 2024 ğŸµ
```

**Sistema de detecciÃ³n de imagen:**
```javascript
// Pseudo-cÃ³digo
function detectImageUrl(text) {
  const imageExtensions = ['.png', '.jpg', '.jpeg', '.gif'];
  const urlRegex = /(https?:\/\/[^\s]+)/g;
  const urls = text.match(urlRegex) || [];
  
  for (const url of urls) {
    if (imageExtensions.some(ext => url.toLowerCase().endsWith(ext))) {
      return url;
    }
  }
  return null;
}

async function sendWelcome(newUser, group) {
  const config = await getGroupConfig(group.id);
  let message = config.welcomeMessage;
  
  // Reemplazar placeholders
  message = message.replace('{user}', `@${newUser.id}`);
  message = message.replace('{group}', group.name);
  message = message.replace('{members}', group.participants.length);
  
  const imageUrl = detectImageUrl(config.welcomeMessage);
  
  if (imageUrl) {
    // Descargar imagen y enviar como attachment
    const imageBuffer = await downloadImage(imageUrl);
    await sock.sendMessage(group.id, {
      image: imageBuffer,
      caption: message.replace(imageUrl, '').trim()
    });
  } else {
    // Enviar solo texto
    await sock.sendMessage(group.id, { text: message });
  }
}
```

---

## Sistema de ModeraciÃ³n

### LÃ³gica de IdentificaciÃ³n de Objetivo y Motivo

**Prioridad 1: MenciÃ³n directa con motivo explÃ­cito**
```
Admin: .warn @51987654321 Lenguaje inapropiado

[SISTEMA IDENTIFICA]
- Objetivo: @51987654321
- Motivo: "Lenguaje inapropiado"
```

**Prioridad 2: Respuesta a mensaje (reply)**
```
[Usuario envÃ­a]: "Hijo de puta"
[Admin responde al mensaje con]: .warn

[SISTEMA IDENTIFICA]
- Objetivo: Autor del mensaje respondido
- Motivo: "Hijo de puta" (contenido del mensaje)
```

**Prioridad 3: Respuesta con motivo adicional**
```
[Usuario envÃ­a]: "Hola a todos"
[Admin responde]: .warn Spam repetido

[SISTEMA]
- Objetivo: Autor del mensaje
- Motivo: "Spam repetido" (prioridad sobre contenido)
```

**Prioridad 4: Sin contexto**
```
Admin: .warn @51987654321

[SISTEMA]
- Objetivo: @51987654321
- Motivo: "Sin motivo especificado"
```

### Comando: `.warn`
**Permisos:** Administradores  
**Alias:** `.advertir`, `.warning`

**Caso 1: Primera advertencia (1/3)**
```
Admin: .warn @Diego Spam en el grupo

[SISTEMA]
- Busca usuario en BD
- warns: [] â†’ [{ motivo: "Spam en el grupo", admin: "+51 999 111 222", fecha: Timestamp }]
- Contador: 1/3

Bot:
âš ï¸ ADVERTENCIA

@Diego ha sido advertido.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ Motivo: Spam en el grupo
ğŸ‘® Admin: @AdminName
âš ï¸ Advertencias: 1/3
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¡ Al llegar a 3 advertencias serÃ¡s expulsado.
```

**Caso 2: Segunda advertencia (2/3)**
```
Admin responde a mensaje ofensivo con: .warn

[SISTEMA]
- Mensaje original: "Eres un idiota"
- warns: [prev] â†’ [...prev, new]
- Contador: 2/3

Bot:
âš ï¸ ADVERTENCIA #2

@Diego ha sido advertido nuevamente.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ Motivo: "Eres un idiota"
ğŸ‘® Admin: @AdminName
âš ï¸ Advertencias: 2/3
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš¨ ÃšLTIMA ADVERTENCIA
Una mÃ¡s y serÃ¡s expulsado automÃ¡ticamente.
```

**Caso 3: Tercera advertencia (3/3) â†’ ExpulsiÃ³n automÃ¡tica**
```
Admin: .warn @Diego Insultos repetidos

[SISTEMA]
- warns: [...] â†’ [..., new]
- Contador: 3/3 â†’ LÃMITE ALCANZADO
- Ejecuta expulsiÃ³n automÃ¡tica
- (Opcional) Resetea warns a 0

Bot:
ğŸš« LÃMITE DE ADVERTENCIAS ALCANZADO

@Diego ha superado el lÃ­mite de 3 advertencias.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ Ãšltima infracciÃ³n: Insultos repetidos
ğŸ‘® Admin: @AdminName
âš ï¸ Advertencias: 3/3
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸšª EXPULSANDO DEL GRUPO...

[SISTEMA ejecuta groupParticipantsUpdate]

Bot (despuÃ©s de expulsar):
âœ… @Diego ha sido expulsado del grupo.
```

### Comando: `.kick`
**Permisos:** Administradores  
**Alias:** `.expulsar`, `.remove`

**EjecuciÃ³n con menciÃ³n:**
```
Admin: .kick @Diego Comportamiento tÃ³xico

[SISTEMA]
- Registra en historial de kicks:
  kicks: [{ motivo: "Comportamiento tÃ³xico", admin: "+51 999 111 222", fecha: Timestamp }]
- Ejecuta expulsiÃ³n via Baileys

Bot:
ğŸšª EXPULSIÃ“N EN PROCESO

@Diego serÃ¡ removido del grupo.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ Motivo: Comportamiento tÃ³xico
ğŸ‘® Admin: @AdminName
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[Mensaje animado con ediciÃ³n]
Se va... se va... se va...

[Mensaje final]:
âœ… Â¡SE FUE!

@Diego ha sido expulsado del grupo.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ Motivo: Comportamiento tÃ³xico
ğŸ‘® Expulsado por: @AdminName
â° 24/12/2024 - 18:15:45
```

**EjecuciÃ³n respondiendo mensaje:**
```
[Usuario publica spam]
[Admin responde con]: .kick

[SISTEMA]
- Identifica autor del mensaje
- Motivo: Contenido del mensaje original
- Ejecuta expulsiÃ³n

Bot:
âœ… Â¡SE FUE!

@Usuario ha sido expulsado del grupo.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ Motivo: [contenido del mensaje spam]
ğŸ‘® Expulsado por: @AdminName
â° 24/12/2024 - 18:20:10
```

---

## Sistema de Juegos de Casino

### Requisitos Generales

**Condiciones para jugar:**
1. Tener dinero en **wallet** (efectivo)
2. Si wallet = 0 â†’ Mensaje: "Usa .retirar <cantidad> para sacar dinero del banco"
3. Si bank = 0 y wallet = 0 â†’ Mensaje: "No tienes dinero. EnvÃ­a mensajes para ganar."
4. Apuesta mÃ­nima: $1.00

**Flujo general:**
```javascript
// ValidaciÃ³n antes de jugar
async function validateGambling(userId, betAmount) {
  const user = await getUser(userId);
  
  if (betAmount < 1.00) {
    return { valid: false, message: "Apuesta mÃ­nima: $1.00" };
  }
  
  if (user.wallet < betAmount) {
    if (user.bank > 0) {
      return { 
        valid: false, 
        message: `No tienes suficiente efectivo.\nğŸ’¡ Usa .retirar ${betAmount} para sacar dinero.` 
      };
    } else {
      return { 
        valid: false, 
        message: "No tienes dinero.\nEnvÃ­a mensajes para ganar." 
      };
    }
  }
  
  return { valid: true };
}
```

### Juego 1: Tragamonedas (`.slot`)

**Comando:** `.slot <cantidad>`  
**Alias:** `.tragaperras <cantidad>`, `.slots <cantidad>`

**Probabilidades:**
- 3 iguales (Jackpot): 5% â†’ Paga x10
- 2 iguales: 30% â†’ Paga x1.5
- Diferentes: 65% â†’ Pierde todo

**SÃ­mbolos:** ğŸ’ ğŸ‹ ğŸ‡ ğŸ’ 7ï¸âƒ£

**EjecuciÃ³n:**
```
Usuario: .slot 10

[Mensaje inicial]
ğŸ° CASINO RAVEHUB ğŸ°
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
| ğŸŸ© | ğŸŸ© | ğŸŸ© |
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
GIRANDO...

[Edita despuÃ©s de 1s]
ğŸ° CASINO RAVEHUB ğŸ°
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
| ğŸ’ | ğŸŸ© | ğŸŸ© |
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
...

[Edita despuÃ©s de 2s]
ğŸ° CASINO RAVEHUB ğŸ°
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
| ğŸ’ | ğŸ’ | ğŸŸ© |
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
...

[Mensaje final - Resultado]
ğŸ° CASINO RAVEHUB ğŸ°
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
| ğŸ’ | ğŸ’ | ğŸ‹ |
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Â¡Casi! Tienes par de cerezas ğŸ’ğŸ’
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’° Ganaste: $15.00 (x1.5)
ğŸ’µ Efectivo: $5.00 â†’ $20.00
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¡ Deposita tus ganancias con .deposit all
```

**Resultado - Jackpot:**
```
ğŸ° CASINO RAVEHUB ğŸ°
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
| 7ï¸âƒ£ | 7ï¸âƒ£ | 7ï¸âƒ£ |
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‰ Â¡Â¡Â¡JACKPOT!!! ğŸ‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’ Ganaste: $100.00 (x10)
ğŸ’µ Efectivo: $5.00 â†’ $105.00
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ† Â¡ERES UN GANADOR!
```

**Resultado - PÃ©rdida:**
```
ğŸ° CASINO RAVEHUB ğŸ°
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
| ğŸ‹ | ğŸ‡ | ğŸ’ |
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ˜” No hubo suerte esta vez
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¸ Perdiste: $10.00
ğŸ’µ Efectivo: $15.00 â†’ $5.00
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ² Intenta de nuevo con .slot <cantidad>
```

### Juego 2: Cara o Cruz (`.flip`)

**Comando:** `.flip <cantidad> <cara/cruz>`  
**Alias:** `.coinflip <cantidad> <opciÃ³n>`, `.moneda <cantidad> <opciÃ³n>`

**Probabilidades:**
- 50% ganar
- 50% perder

**Pago:** x1.95 (comisiÃ³n del 5% para la casa)

**EjecuciÃ³n:**
```
Usuario: .flip 5 cara

[Mensaje inicial]
ğŸª™ CARA O CRUZ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Apostaste: $5.00 a CARA
Lanzando moneda... ğŸ¤œğŸª™

[Edita despuÃ©s de 1s]
ğŸª™ CARA O CRUZ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Girando en el aire... ğŸŒ€

[Mensaje final - GanÃ³]
ğŸª™ CARA O CRUZ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Resultado: CARA ğŸ¤´
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… Â¡GANASTE!
ğŸ’° Premio: $9.75 (x1.95)
ğŸ’µ Efectivo: $10.00 â†’ $14.75
```

**Mensaje final - PerdiÃ³:**
```
ğŸª™ CARA O CRUZ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Resultado: CRUZ âš”ï¸
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âŒ Perdiste
Apostaste a CARA pero saliÃ³ CRUZ
ğŸ’¸ PÃ©rdida: $5.00
ğŸ’µ Efectivo: $10.00 â†’ $5.00
```

### Juego 3: Dados (`.dice`)

**Comando:** `.dice <cantidad> <mas/menos>`  
**Alias:** `.dados <cantidad> <opciÃ³n>`, `.roll <cantidad> <opciÃ³n>`

**Reglas:**
- Se lanzan 2 dados (1-6)
- Apostar si la suma es MAYOR o MENOR a 7
- Si sale exactamente 7 â†’ La casa gana (pierde el jugador)

**Probabilidades:**
- Acierta: Paga x2
- Falla o sale 7: Pierde todo

**EjecuciÃ³n:**
```
Usuario: .dice 20 mas

[Mensaje inicial]
ğŸ² DADOS - HIGH/LOW
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Apostaste: $20.00 a MÃS DE 7
Agitando el cubilete... ğŸ¥¤

[Edita despuÃ©s de 1s]
ğŸ² DADOS - HIGH/LOW
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Tirando dados... ğŸ² ğŸ²

[Mensaje final - GanÃ³]
ğŸ² DADOS - HIGH/LOW
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Dados: [ âš„ ] [ âš… ] = 11
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… Â¡GANASTE!
Apostaste MÃS y saliÃ³ 11
ğŸ’° Premio: $40.00 (x2)
ğŸ’µ Efectivo: $15.00 â†’ $35.00
```

**Mensaje final - PerdiÃ³:**
```
ğŸ² DADOS - HIGH/LOW
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Dados: [ âš ] [ âš‚ ] = 5
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âŒ Perdiste
Apostaste MÃS pero saliÃ³ 5 (MENOS)
ğŸ’¸ PÃ©rdida: $20.00
ğŸ’µ Efectivo: $35.00 â†’ $15.00
```

**Mensaje final - SaliÃ³ 7 (Casa gana):**
```
ğŸ² DADOS - HIGH/LOW
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Dados: [ âšƒ ] [ âšƒ ] = 7
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ›ï¸ LA CASA GANA
SaliÃ³ exactamente 7
ğŸ’¸ PÃ©rdida: $20.00
ğŸ’µ Efectivo: $35.00 â†’ $15.00
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ² El 7 siempre pertenece a la casa
```

---

## Buenas PrÃ¡cticas de ImplementaciÃ³n

### Manejo de Errores (Anti-Crash)

```javascript
// middleware/anticrash.js
process.on('uncaughtException', (err) => {
  logger.error('Uncaught Exception:', err);
  // No detener el proceso, solo loggear
});

process.on('unhandledRejection', (reason, promise) => {
  logger.error('Unhandled Rejection:', reason);
});

// Wrapper para comandos
async function safeExecute(commandFn, ...args) {
  try {
    await commandFn(...args);
  } catch (error) {
    logger.error(`Error en comando:`, error);
    // Enviar mensaje de error amigable al usuario
    await sendMessage(args[0].chat, 
      "âŒ OcurriÃ³ un error al procesar tu comando.\nIntenta de nuevo en unos segundos."
    );
  }
}
```

### Operaciones AsÃ­ncronas

```javascript
// Todas las operaciones deben ser async/await
async function processMessage(message) {
  // Operaciones paralelas cuando sea posible
  const [user, groupConfig] = await Promise.all([
    getUser(message.sender),
    getGroupConfig(message.chat)
  ]);
  
  // Operaciones secuenciales cuando dependan una de otra
  await updateMessageCount(user.id);
  const newBalance = await checkPendingPayment(user.id);
  
  if (newBalance > 0) {
    await notifyPayment(message.chat, user.id, newBalance);
  }
}
```

### Rate Limiting

```javascript
// middleware/ratelimit.js
const userCooldowns = new Map();

function checkRateLimit(userId, commandName, cooldownSeconds = 3) {
  const key = `${userId}:${commandName}`;
  const now = Date.now();
  
  if (userCooldowns.has(key)) {
    const lastUsed = userCooldowns.get(key);
    const timePassed = (now - lastUsed) / 1000;
    
    if (timePassed < cooldownSeconds) {
      const remaining = Math.ceil(cooldownSeconds - timePassed);
      return { allowed: false, remaining };
    }
  }
  
  userCooldowns.set(key, now);
  return { allowed: true };
}
```

### GestiÃ³n de ConexiÃ³n PM2

```javascript
// ecosystem.config.js
module.exports = {
  apps: [{
    name: 'whatsapp-bot',
    script: './index.js',
    instances: 1,
    exec_mode: 'fork',
    autorestart: true,
    watch: false,
    max_memory_restart: '500M',
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    error_file: './logs/error.log',
    out_file: './logs/output.log',
    log_date_format: 'YYYY-MM-DD HH:mm:ss',
    merge_logs: true,
    min_uptime: '10s',
    max_restarts: 10,
    restart_delay: 4000
  }]
};
```

### Logging Estructurado

```javascript
// utils/logger.js
const winston = require('winston');

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ filename: 'logs/error.log', level: 'error' }),
    new winston.transports.File({ filename: 'logs/combined.log' }),
    new winston.transports.Console({
      format: winston.format.simple()
    })
  ]
});

// Uso
logger.info('Bot iniciado', { uptime: process.uptime() });
logger.error('Error en comando', { comando: '.rob', error: err.message });
```

### ReconexiÃ³n AutomÃ¡tica de Baileys

```javascript
// handlers/connection.js
async function startBot() {
  const { state, saveCreds } = await useMultiFileAuthState('./auth_info');
  
  const sock = makeWASocket({
    auth: state,
    printQRInTerminal: true,
    browser: ['RaveHub Bot', 'Chrome', '1.0.0'],
    connectTimeoutMs: 60000,
    defaultQueryTimeoutMs: 0,
    keepAliveIntervalMs: 10000,
    emitOwnEvents: true,
    getMessage: async (key) => {
      // Recuperar mensajes de la base de datos si es necesario
      return { conversation: '' };
    }
  });
  
  // Guardar credenciales cuando cambien
  sock.ev.on('creds.update', saveCreds);
  
  // Manejar actualizaciones de conexiÃ³n
  sock.ev.on('connection.update', async (update) => {
    const { connection, lastDisconnect, qr } = update;
    
    if (qr) {
      logger.info('QR Code generado');
    }
    
    if (connection === 'close') {
      const shouldReconnect = lastDisconnect?.error?.output?.statusCode !== DisconnectReason.loggedOut;
      
      logger.info('ConexiÃ³n cerrada', { shouldReconnect });
      
      if (shouldReconnect) {
        // Reconectar despuÃ©s de 5 segundos
        setTimeout(() => startBot(), 5000);
      }
    } else if (connection === 'open') {
      logger.info('ConexiÃ³n establecida exitosamente');
      
      // Enviar mensaje de confirmaciÃ³n al bot owner
      const botNumber = sock.user.id.split(':')[0];
      await sock.sendMessage(`${botNumber}@s.whatsapp.net`, {
        text: `ğŸ¤– BOT CONECTADO EXITOSAMENTE\n\nğŸ“Š Detalles del servidor:\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ–¥ï¸ Servidor: AWS EC2\nâš¡ Proceso: PM2\nğŸ”„ Estado: ONLINE\nğŸ“¶ Latencia: ${Date.now()}ms\nâ° Conectado: ${new Date().toLocaleString()}\nğŸ’¾ Memoria: ${Math.round(process.memoryUsage().heapUsed / 1024 / 1024)}MB\nğŸ”¥ Firebase: Conectado\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nâœ… El bot estÃ¡ listo para usarse.\nUsa .listgroups para ver grupos disponibles.`
      });
    }
  });
  
  return sock;
}
```

---

## Estructura de Firebase Firestore

### Colecciones Principales

```javascript
// Estructura completa de la base de datos

firestore/
â”œâ”€â”€ users/
â”‚   â””â”€â”€ {userId}/
â”‚       â”œâ”€â”€ id: string
â”‚       â”œâ”€â”€ phone: string
â”‚       â”œâ”€â”€ name: string
â”‚       â”œâ”€â”€ joinedAt: Timestamp
â”‚       â”œâ”€â”€ lastMessage: Timestamp
â”‚       â”œâ”€â”€ activeDays: number
â”‚       â”œâ”€â”€ birthday: string | null
â”‚       â”œâ”€â”€ totalMessages: number
â”‚       â”œâ”€â”€ wallet: number
â”‚       â”œâ”€â”€ bank: number
â”‚       â”œâ”€â”€ pending: number
â”‚       â”œâ”€â”€ debt: number
â”‚       â”œâ”€â”€ level: number
â”‚       â”œâ”€â”€ levelName: string
â”‚       â”œâ”€â”€ warns: Array<{motivo, admin, fecha}>
â”‚       â”œâ”€â”€ kicks: Array<{motivo, admin, fecha}>
â”‚       â””â”€â”€ messages/ (subcolecciÃ³n)
â”‚           â””â”€â”€ {messageId}/
â”‚               â”œâ”€â”€ content: string
â”‚               â”œâ”€â”€ timestamp: Timestamp
â”‚               â”œâ”€â”€ mentions: Array<string>
â”‚               â””â”€â”€ repliedTo: string | null
â”‚
â”œâ”€â”€ groups/
â”‚   â””â”€â”€ {groupId}/
â”‚       â”œâ”€â”€ active: boolean
â”‚       â”œâ”€â”€ name: string
â”‚       â”œâ”€â”€ participants: number
â”‚       â”œâ”€â”€ activatedAt: Timestamp
â”‚       â”œâ”€â”€ deactivatedAt: Timestamp | null
â”‚       â”œâ”€â”€ settings/
â”‚       â”‚   â”œâ”€â”€ welcome/
â”‚       â”‚   â”‚   â”œâ”€â”€ enabled: boolean
â”‚       â”‚   â”‚   â”œâ”€â”€ message: string
â”‚       â”‚   â”‚   â””â”€â”€ imageUrl: string | null
â”‚       â”‚   â”œâ”€â”€ farewell/
â”‚       â”‚   â”‚   â”œâ”€â”€ enabled: boolean
â”‚       â”‚   â”‚   â””â”€â”€ message: string
â”‚       â”‚   â””â”€â”€ antilink: boolean
â”‚       â”œâ”€â”€ premiumUsers: Array<string>
â”‚       â”œâ”€â”€ members/ (subcolecciÃ³n)
â”‚       â”‚   â””â”€â”€ {userId}/
â”‚       â”‚       â”œâ”€â”€ joinedAt: Timestamp
â”‚       â”‚       â”œâ”€â”€ isAdmin: boolean
â”‚       â”‚       â””â”€â”€ isPremium: boolean
â”‚       â””â”€â”€ economy/ (subcolecciÃ³n)
â”‚           â””â”€â”€ {userId}/
â”‚               â”œâ”€â”€ messages: number
â”‚               â”œâ”€â”€ wallet: number
â”‚               â””â”€â”€ bank: number
â”‚
â”œâ”€â”€ shop/
â”‚   â””â”€â”€ inventory/
â”‚       â””â”€â”€ items: Array<{
â”‚           id: number,
â”‚           name: string,
â”‚           description: string,
â”‚           price: number,
â”‚           category: string,
â”‚           available: boolean,
â”‚           stock: number
â”‚       }>
â”‚
â””â”€â”€ orders/
    â””â”€â”€ {orderId}/
        â”œâ”€â”€ orderId: string
        â”œâ”€â”€ userId: string
        â”œâ”€â”€ userName: string
        â”œâ”€â”€ userPhone: string
        â”œâ”€â”€ itemId: number
        â”œâ”€â”€ itemName: string
        â”œâ”€â”€ price: number
        â”œâ”€â”€ status: string (PENDING|DELIVERED|REJECTED)
        â”œâ”€â”€ createdAt: Timestamp
        â”œâ”€â”€ deliveredAt: Timestamp | null
        â”œâ”€â”€ rejectedAt: Timestamp | null
        â”œâ”€â”€ handledBy: string | null
        â””â”€â”€ groupId: string
```

---

## Flujo Completo de Mensaje

### Diagrama de Flujo

```
1. Usuario envÃ­a mensaje en grupo
   â†“
2. Verificar si grupo estÃ¡ activo (Firestore)
   â†“ No â†’ Ignorar
   â†“ SÃ­
3. Verificar si usuario existe en BD
   â†“ No â†’ Crear usuario con datos iniciales
   â†“ SÃ­ â†’ Continuar
4. Actualizar contador de mensajes
   â†“
5. Guardar mensaje en subcolecciÃ³n
   â†“
6. Actualizar pending (+$0.01)
   â†“
7. Â¿pending >= $0.50?
   â†“ SÃ­ â†’ Transferir a wallet y notificar
   â†“ No â†’ Continuar
8. Â¿El usuario tiene deuda?
   â†“ SÃ­ â†’ Pagar deuda con pending
   â†“ No â†’ Continuar
9. Recalcular nivel basado en patrimonio
   â†“
10. Â¿CambiÃ³ de nivel?
    â†“ SÃ­ â†’ Notificar subida/bajada
    â†“ No â†’ Continuar
11. Â¿Es un comando?
    â†“ No â†’ Fin
    â†“ SÃ­
12. Validar permisos del usuario
    â†“ Sin permiso â†’ Responder error
    â†“ Con permiso
13. Verificar rate limit
    â†“ Excedido â†’ Responder cooldown
    â†“ Ok
14. Ejecutar comando de forma asÃ­ncrona
    â†“
15. Manejar errores si ocurren
    â†“
16. Enviar respuesta al usuario
    â†“
17. Fin
```

### Pseudo-cÃ³digo del Handler Principal

```javascript
// handlers/messages.js
async function handleIncomingMessage(sock, message) {
  try {
    // 1. Validaciones bÃ¡sicas
    if (!message.message) return;
    if (message.key.fromMe && !message.key.remoteJid.endsWith('@g.us')) return;
    
    const isGroup = message.key.remoteJid.endsWith('@g.us');
    if (!isGroup) return; // Solo procesar grupos
    
    // 2. Extraer informaciÃ³n
    const groupId = message.key.remoteJid;
    const userId = message.key.participant || message.key.remoteJid;
    const messageText = extractMessageText(message);
    
    // 3. Verificar grupo activo
    const groupConfig = await getGroupConfig(groupId);
    if (!groupConfig?.active) return;
    
    // 4. Verificar/Crear usuario
    let user = await getUser(userId);
    if (!user) {
      user = await createUser(userId, message);
    }
    
    // 5. Actualizar estadÃ­sticas
    await updateUserStats(userId, messageText, message);
    
    // 6. Sistema econÃ³mico
    await processEconomy(userId);
    
    // 7. Sistema de niveles
    await processLevelSystem(userId, groupId);
    
    // 8. Verificar si es comando
    if (!messageText.startsWith('.')) return;
    
    const [commandName, ...args] = messageText.slice(1).split(' ');
    
    // 9. Validar permisos
    const hasPermission = await checkPermission(userId, groupId, commandName);
    if (!hasPermission) {
      await sock.sendMessage(groupId, {
        text: 'âŒ No tienes permiso para este comando.',
        quoted: message
      });
      return;
    }
    
    // 10. Rate limiting
    const rateLimit = checkRateLimit(userId, commandName);
    if (!rateLimit.allowed) {
      await sock.sendMessage(groupId, {
        text: `â±ï¸ Espera ${rateLimit.remaining}s antes de usar este comando.`,
        quoted: message
      });
      return;
    }
    
    // 11. Ejecutar comando
    await executeCommand(sock, message, commandName, args);
    
  } catch (error) {
    logger.error('Error procesando mensaje:', error);
    await sock.sendMessage(message.key.remoteJid, {
      text: 'âŒ OcurriÃ³ un error inesperado. Intenta de nuevo.',
      quoted: message
    });
  }
}
```

---

## Comandos de Referencia RÃ¡pida

### Tabla de Comandos

| Comando | Permisos | DescripciÃ³n | Ejemplo |
|---------|----------|-------------|---------|
| `.ping` | Bot, Admins | Verifica latencia del bot | `.ping` |
| `.listgroups` | Bot (DM) | Lista grupos disponibles | `.listgroups` |
| `.bot on <id>` | Bot (DM) | Activa bot en grupo | `.bot on 120363025@g.us` |
| `.bot off <id>` | Bot (DM) | Desactiva bot en grupo | `.bot off 120363025@g.us` |
| `.me` | Todos | Muestra perfil propio | `.me` |
| `.info @user` | Todos | Muestra perfil de usuario | `.info @51987654321` |
| `.rob @user` | Nivel 2+ | Intenta robar dinero | `.rob @usuario` |
| `.deposit <cant>` | Todos | Deposita dinero en banco | `.deposit 10` o `.dep all` |
| `.withdraw <cant>` | Todos | Retira dinero del banco | `.withdraw 5` |
| `.shop` | Todos | Muestra tienda | `.shop` |
| `.buy <num>` | Todos | Compra item de tienda | `.buy 1` |
| `.requests` | Admins | Lista pedidos pendientes | `.requests` |
| `.deliver <id>` | Admins | Marca pedido entregado | `.deliver ORD-001` |
| `.reject <id>` | Admins | Rechaza y reembolsa pedido | `.reject ORD-002` |
| `.welcome on` | Admins | Activa bienvenidas | `.welcome on` |
| `.welcome off` | Admins | Desactiva bienvenidas | `.welcome off` |
| `.welcome message` | Admins | Configura mensaje | `.welcome message Hola {user}!` |
| `.warn @user` | Admins | Advierte a usuario | `.warn @user Spam` |
| `.kick @user` | Admins | Expulsa usuario | `.kick @user TÃ³xico` |
| `.slot <cant>` | Todos | Juego tragamonedas | `.slot 10` |
| `.flip <cant> <opciÃ³n>` | Todos | Juego cara o cruz | `.flip 5 cara` |
| `.dice <cant> <opciÃ³n>` | Todos | Juego de dados | `.dice 20 mas` |

---

## Consideraciones de Seguridad

### Variables de Entorno (.env)

```env
# Firebase
FIREBASE_PROJECT_ID=tu-proyecto
FIREBASE_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----
FIREBASE_CLIENT_EMAIL=firebase-adminsdk@tu-proyecto.iam.gserviceaccount.com

# Bot Configuration
BOT_NAME=RaveHub Bot
BOT_PREFIX=.
BOT_OWNER=51999111222

# AWS
AWS_REGION=us-east-1

# Environment
NODE_ENV=production
PORT=3000
```

### ProtecciÃ³n de Datos Sensibles

```javascript
// No almacenar mensajes completos indefinidamente
// Implementar limpieza automÃ¡tica de mensajes antiguos
async function cleanOldMessages() {
  const thirtyDaysAgo = new Date();
  thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
  
  // Eliminar mensajes mayores a 30 dÃ­as
  await db.collectionGroup('messages')
    .where('timestamp', '<', thirtyDaysAgo)
    .get()
    .then(snapshot => {
      const batch = db.batch();
      snapshot.docs.forEach(doc => batch.delete(doc.ref));
      return batch.commit();
    });
}

// Ejecutar diariamente
setInterval(cleanOldMessages, 24 * 60 * 60 * 1000);
```

### Rate Limiting Global

```javascript
// Prevenir abuso del bot
const globalRateLimit = new Map();

function checkGlobalRateLimit(groupId) {
  const now = Date.now();
  const windowMs = 60000; // 1 minuto
  const maxRequests = 30; // 30 comandos por minuto por grupo
  
  if (!globalRateLimit.has(groupId)) {
    globalRateLimit.set(groupId, []);
  }
  
  const requests = globalRateLimit.get(groupId);
  const recentRequests = requests.filter(time => now - time < windowMs);
  
  if (recentRequests.length >= maxRequests) {
    return { allowed: false, resetIn: Math.ceil((windowMs - (now - recentRequests[0])) / 1000) };
  }
  
  recentRequests.push(now);
  globalRateLimit.set(groupId, recentRequests);
  
  return { allowed: true };
}
```

---

## Monitoreo y Mantenimiento

### Health Check Endpoint

```javascript
// index.js
const express = require('express');
const app = express();

app.get('/health', async (req, res) => {
  const health = {
    uptime: process.uptime(),
    status: 'OK',
    timestamp: Date.now(),
    memory: {
      used: Math.round(process.memoryUsage().heapUsed / 1024 / 1024),
      total: Math.round(process.memoryUsage().heapTotal / 1024 / 1024)
    },
    bot: {
      connected: sock?.user ? true : false,
      user: sock?.user?.id || null
    }
  };
  
  res.json(health);
});

app.listen(process.env.PORT || 3000);
```

### Comandos PM2 Ãštiles

```bash
# Iniciar bot
pm2 start ecosystem.config.js

# Ver logs en tiempo real
pm2 logs whatsapp-bot

# Reiniciar bot
pm2 restart whatsapp-bot

# Detener bot
pm2 stop whatsapp-bot

# Ver estado
pm2 status

# Monitorear recursos
pm2 monit

# Guardar configuraciÃ³n actual
pm2 save

# Configurar inicio automÃ¡tico en boot
pm2 startup
```

---

## Resumen de Funcionalidades

âœ… **ConexiÃ³n y AutenticaciÃ³n**
- QR Code para vincular dispositivo
- ReconexiÃ³n automÃ¡tica
- SesiÃ³n persistente
- NotificaciÃ³n de conexiÃ³n exitosa al DM del bot

âœ… **GestiÃ³n de Grupos**
- ActivaciÃ³n/desactivaciÃ³n por grupo
- Lista de grupos disponibles
- ConfiguraciÃ³n independiente por grupo

âœ… **Sistema de Usuarios**
- Registro automÃ¡tico en primera interacciÃ³n
- Tracking completo de mensajes y menciones
- Historial de warns y kicks
- Perfil consultable

âœ… **Sistema EconÃ³mico**
- Ganancia por mensajes ($0.01/mensaje)
- Pago diferido cada $0.50
- Sistema bancario (wallet + bank)
- ProtecciÃ³n contra robos (dinero en banco)

âœ… **Sistema de Niveles**
- 11 niveles basados en patrimonio neto
- Notificaciones de subida/bajada
- Nombres temÃ¡ticos de festival

âœ… **Sistema de Robos**
- Probabilidades realistas
- Multas por fallos
- Sistema de deudas
- Solo afecta dinero en efectivo

âœ… **Tienda y Pedidos**
- Inventario configurable
- Sistema de IDs Ãºnicos para pedidos
- GestiÃ³n de pedidos por admins
- Reembolsos automÃ¡ticos

âœ… **Sistema de Bienvenidas**
- Mensajes personalizables
- Placeholders dinÃ¡micos
- Soporte para imÃ¡genes
- ActivaciÃ³n/desactivaciÃ³n por grupo

âœ… **ModeraciÃ³n**
- Warns acumulativos (3 = expulsiÃ³n)
- Kicks con registro
- DetecciÃ³n inteligente de objetivo y motivo
- Respuestas a mensajes para sancionar

âœ… **Juegos de Casino**
- Tragamonedas con animaciÃ³n
- Cara o cruz
- Dados (high/low)
- Validaciones de fondos
- ComisiÃ³n de la casa

âœ… **Seguridad y Estabilidad**
- Manejo global de errores
- Operaciones 100% asÃ­ncronas
- Rate limiting por usuario y grupo
- ReconexiÃ³n automÃ¡tica
- PM2 para alta disponibilidad
- Logs estructurados

---

## Referencias y DocumentaciÃ³n

### Baileys
- **DocumentaciÃ³n oficial:** https://baileys.wiki/docs/intro/
- **Repositorio GitHub:** https://github.com/WhiskeySockets/Baileys
- **Ejemplo de bot:** https://github.com/lyfe00011/levanter

### Firebase
- **DocumentaciÃ³n:** https://firebase.google.com/docs
- **Firestore:** https://firebase.google.com/docs/firestore
- **Admin SDK:** https://firebase.google.com/docs/admin/setup

### Node.js
- **VersiÃ³n requerida:** 17+
- **Async/Await:** https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function
- **Event Emitters:** https://nodejs.org/api/events.html

### PM2
- **DocumentaciÃ³n:** https://pm2.keymetrics.io/docs/usage/quick-start/
- **Ecosystem File:** https://pm2.keymetrics.io/docs/usage/application-declaration/

---

# Ejemplos de Uso Completos - Bot WhatsApp RaveHub

## Ãndice de Comandos
1. [Comandos de AdministraciÃ³n del Bot](#comandos-de-administraciÃ³n-del-bot)
2. [Comandos de InformaciÃ³n de Usuario](#comandos-de-informaciÃ³n-de-usuario)
3. [Comandos EconÃ³micos](#comandos-econÃ³micos)
4. [Sistema de Robos](#sistema-de-robos)
5. [Sistema de Tienda](#sistema-de-tienda)
6. [GestiÃ³n de Pedidos (Admins)](#gestiÃ³n-de-pedidos-admins)
7. [Sistema de Bienvenidas](#sistema-de-bienvenidas)
8. [Comandos de ModeraciÃ³n](#comandos-de-moderaciÃ³n)
9. [Juegos de Casino](#juegos-de-casino)

---

## Comandos de AdministraciÃ³n del Bot

### 1. `.ping` - Verificar Estado del Bot

**Contexto:** Admin quiere verificar si el bot estÃ¡ respondiendo correctamente.

**Entrada del Usuario:**
```
Admin: .ping
```

**Respuesta del Bot:**
```
ğŸ“ PONG!

âš¡ Latencia: 42ms
ğŸ–¥ï¸ Servidor: AWS EC2 (us-east-1)
ğŸ”¥ Firebase: 18ms
ğŸ’š Estado: ONLINE
â° Uptime: 12h 34m 18s
ğŸ’¾ Memoria: 156MB / 1GB
ğŸ”„ CPU: 12%
ğŸ“Š Comandos procesados: 1,247
```

**Caso 2: Bot con problemas de latencia**
```
Admin: .ping

Bot responde:
ğŸ“ PONG!

âš¡ Latencia: 892ms âš ï¸
ğŸ–¥ï¸ Servidor: AWS EC2
ğŸ”¥ Firebase: 421ms âš ï¸
ğŸ’› Estado: DEGRADADO
â° Uptime: 2h 15m 03s
ğŸ’¾ Memoria: 456MB / 1GB
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ Alta latencia detectada
```

---

### 2. `.listgroups` - Listar Grupos Disponibles

**Contexto:** El bot (en su propio DM) quiere ver en quÃ© grupos estÃ¡ presente.

**Entrada del Usuario (Bot):**
```
Bot (en su DM): .listgroups
```

**Respuesta del Bot:**
```
ğŸ“‹ GRUPOS DISPONIBLES

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1ï¸âƒ£ RaveHub Community
ğŸ“Œ ID: 120363025@g.us
ğŸ‘¥ Participantes: 247
ğŸ¤– Estado: âŒ INACTIVO
ğŸ“… Creado: 15/08/2024
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2ï¸âƒ£ Festival Squad 2024
ğŸ“Œ ID: 120363189@g.us
ğŸ‘¥ Participantes: 89
ğŸ¤– Estado: âœ… ACTIVO
ğŸ“… Activado: 20/12/2024
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
3ï¸âƒ£ Techno Lovers Chile
ğŸ“Œ ID: 120363267@g.us
ğŸ‘¥ Participantes: 156
ğŸ¤– Estado: âŒ INACTIVO
ğŸ“… Creado: 03/11/2024
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
4ï¸âƒ£ EDM Santiago
ğŸ“Œ ID: 120363342@g.us
ğŸ‘¥ Participantes: 312
ğŸ¤– Estado: âœ… ACTIVO
ğŸ“… Activado: 18/12/2024
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š Total: 4 grupos
âœ… Activos: 2
âŒ Inactivos: 2

ğŸ’¡ Usa: .bot on <ID> para activar
ğŸ’¡ Usa: .bot off <ID> para desactivar
```

**Alias del comando:**
```
Bot: .listargrupos
Bot: .grupos
```

---

### 3. `.bot on <id_grupo>` - Activar Bot en Grupo

**Contexto:** El bot necesita activarse en un grupo especÃ­fico.

**Entrada del Usuario (Bot en su DM):**
```
Bot: .bot on 120363025@g.us
```

**Respuesta del Bot (Mensaje con animaciÃ³n):**

**Paso 1 (Inmediato):**
```
ğŸ”„ ACTIVANDO BOT

ğŸ“ Grupo: RaveHub Community
ğŸ†” ID: 120363025@g.us
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Iniciando sistema...
```

**Paso 2 (EdiciÃ³n cada 500ms):**
```
â³ Cargando sistema... [â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 10%
```

```
â³ Cargando sistema... [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘] 30%
```

```
â³ Cargando sistema... [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘] 60%
```

```
â³ Cargando sistema... [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 80%
```

```
â³ Cargando sistema... [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%
```

**Paso 3 (Mensaje final):**
```
âœ… BOT ACTIVADO EXITOSAMENTE

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ Grupo: RaveHub Community
ğŸ†” ID: 120363025@g.us
ğŸ‘¥ Participantes: 247
â° Activado: 24/12/2024 - 15:45:30
ğŸ”§ Sistema: v1.0.0
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… El bot ya puede responder comandos en este grupo.

ğŸ’¡ Los admins pueden configurar:
â€¢ .welcome on - Bienvenidas
â€¢ .warn @user - Sistema de advertencias
â€¢ .requests - Ver pedidos
```

**Caso de Error - Grupo No Existe:**
```
Bot: .bot on 999999999@g.us

Respuesta:
âŒ ERROR

No se encontrÃ³ el grupo con ID: 999999999@g.us

ğŸ’¡ Usa .listgroups para ver grupos disponibles
```

**Caso de Error - Grupo Ya Activo:**
```
Bot: .bot on 120363189@g.us

Respuesta:
âš ï¸ GRUPO YA ACTIVO

ğŸ“ Grupo: Festival Squad 2024
ğŸ†” ID: 120363189@g.us
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Este grupo ya estÃ¡ activo desde:
â° 20/12/2024 - 10:30:15

ğŸ’¡ Usa .bot off <ID> para desactivar
```

**Alias del comando:**
```
Bot: .activar 120363025@g.us
Bot: .enable 120363025@g.us
```

---

### 4. `.bot off <id_grupo>` - Desactivar Bot en Grupo

**Contexto:** Necesitas desactivar el bot en un grupo especÃ­fico.

**Entrada del Usuario (Bot en su DM):**
```
Bot: .bot off 120363189@g.us
```

**Respuesta del Bot:**
```
ğŸ”´ BOT DESACTIVADO

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ Grupo: Festival Squad 2024
ğŸ†” ID: 120363189@g.us
ğŸ‘¥ Participantes: 89
â° Desactivado: 24/12/2024 - 16:20:15
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âŒ El bot ignorarÃ¡ todos los comandos en este grupo hasta que sea reactivado.

ğŸ“Š EstadÃ­sticas finales:
â€¢ Comandos procesados: 1,458
â€¢ Tiempo activo: 4 dÃ­as
â€¢ Usuarios registrados: 67

ğŸ’¡ Usa .bot on <ID> para reactivar cuando lo necesites
```

**Caso de Error - Grupo Ya Inactivo:**
```
Bot: .bot off 120363025@g.us

Respuesta:
âš ï¸ GRUPO YA INACTIVO

ğŸ“ Grupo: RaveHub Community
Este grupo ya estÃ¡ desactivado.

ğŸ’¡ Usa .bot on <ID> para activar
```

**Alias del comando:**
```
Bot: .desactivar 120363189@g.us
Bot: .disable 120363189@g.us
```

---

## Comandos de InformaciÃ³n de Usuario

### 5. `.me` - Ver Mi Perfil

**Contexto:** Usuario quiere ver su propia informaciÃ³n.

**Entrada del Usuario:**
```
Diego: .me
```

**Respuesta del Bot:**
```
ğŸ‘¤ PERFIL DE USUARIO

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“› Nombre: Diego RamÃ­rez
ğŸ“ TelÃ©fono: +51 987 654 321
ğŸ†” ID: 51987654321
ğŸ“… Miembro desde: 15/08/2024
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’° ECONOMÃA
ğŸ’µ Efectivo: $12.45
ğŸ¦ Banco: $87.30
ğŸ’ Patrimonio Total: $99.75
ğŸ“Š Pendiente: $0.35

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š ESTADÃSTICAS
âœ‰ï¸ Mensajes enviados: 2,473
ğŸ“ˆ Mensajes hoy: 47
ğŸ‚ CumpleaÃ±os: 15/08
ğŸ“… DÃ­as activo: 127 dÃ­as
â° Ãšltimo mensaje: Hace 3 minutos
ğŸ”¥ Racha: 12 dÃ­as consecutivos

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ¯ NIVEL
ğŸ”° Nivel 10: Booth
ğŸµ "En la cabina, al lado del DJ"
ğŸ“ˆ Progreso: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 97%
ğŸ’° PrÃ³ximo nivel (Headliner): $0.25 mÃ¡s

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âš ï¸ INFRACCIONES
Advertencias: 1/3
Expulsiones: 0

ğŸ’¡ Historial de warns:
  â€¢ 20/12/2024: "Spam en el chat" por @Admin

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ® JUEGOS
ğŸ° Slots jugados: 23
ğŸª™ Coinflips: 15
ğŸ² Dados: 8
ğŸ’° Ganado total: $45.80
ğŸ“‰ Perdido total: $38.20
ğŸ“ˆ Balance: +$7.60
```

**Caso - Usuario Nuevo (Sin EstadÃ­sticas):**
```
NuevoUsuario: .me

Respuesta:
ğŸ‘¤ PERFIL DE USUARIO

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“› Nombre: Carlos Nuevo
ğŸ“ TelÃ©fono: +51 912 345 678
ğŸ†” ID: 51912345678
ğŸ“… Miembro desde: Hoy
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’° ECONOMÃA
ğŸ’µ Efectivo: $0.01
ğŸ¦ Banco: $0.00
ğŸ’ Patrimonio Total: $0.01
ğŸ“Š Pendiente: $0.01

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š ESTADÃSTICAS
âœ‰ï¸ Mensajes enviados: 1
ğŸ“ˆ Mensajes hoy: 1
ğŸ‚ CumpleaÃ±os: No configurado
ğŸ“… DÃ­as activo: 1 dÃ­a
â° Ãšltimo mensaje: Hace 10 segundos

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ¯ NIVEL
ğŸ”° Nivel 1: Youtube
ğŸ“º "Lo ves desde tu casa, no te alcanzÃ³"
ğŸ“ˆ Progreso: â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 0.1%
ğŸ’° PrÃ³ximo nivel (Vereda): $9.99 mÃ¡s

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âš ï¸ INFRACCIONES
Sin infracciones âœ…

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ® JUEGOS
No has jugado aÃºn.

ğŸ’¡ EnvÃ­a mÃ¡s mensajes para ganar dinero
ğŸ’¡ Usa .deposit para proteger tu efectivo
```

**Alias del comando:**
```
Usuario: .perfil
Usuario: .yo
Usuario: .stats
```

---

### 6. `.info @usuario` - Ver Perfil de Otro Usuario

**Contexto:** Usuario quiere ver informaciÃ³n de otro miembro del grupo.

**Entrada del Usuario:**
```
Diego: .info @51912345678
```

**Respuesta del Bot (Usuario Existe):**
```
ğŸ‘¤ PERFIL DE @CarlosMendez

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“› Nombre: Carlos Mendez
ğŸ“ TelÃ©fono: +51 912 345 678
ğŸ†” ID: 51912345678
ğŸ“… Miembro desde: 10/11/2024
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’° ECONOMÃA
ğŸ’µ Efectivo: $3.20
ğŸ¦ Banco: $45.80
ğŸ’ Patrimonio Total: $49.00
ğŸ“Š Pendiente: $0.18

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š ESTADÃSTICAS
âœ‰ï¸ Mensajes enviados: 838
ğŸ“ˆ Mensajes hoy: 12
ğŸ‚ CumpleaÃ±os: 23/03
ğŸ“… DÃ­as activo: 45 dÃ­as
â° Ãšltimo mensaje: Hace 1 hora
ğŸ”¥ Racha: 8 dÃ­as consecutivos

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ¯ NIVEL
ğŸ”° Nivel 5: General
ğŸ¸ "En el pogo, apretado y sudando"
ğŸ“ˆ Progreso: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 45%
ğŸ’° PrÃ³ximo nivel (Preferencial): $1.00 mÃ¡s

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âš ï¸ INFRACCIONES
Advertencias: 0/3
Expulsiones: 0

Sin infracciones âœ…

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ® JUEGOS
ğŸ° Slots jugados: 8
ğŸª™ Coinflips: 5
ğŸ² Dados: 3
ğŸ’° Balance: +$2.10
```

**Caso - Usuario NO Existe en BD:**
```
Diego: .info @51998765432

Respuesta:
âŒ USUARIO NO REGISTRADO

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
@Usuario aÃºn no ha interactuado en este grupo.

Para que un usuario aparezca en el sistema debe:
âœ‰ï¸ Enviar al menos 1 mensaje en el grupo

ğŸ’¡ Una vez que participe, podrÃ¡s consultar su perfil.
```

**Caso - Usuario Mencionado Nunca Ha Hablado:**
```
Diego: .info @51999888777

Respuesta:
âŒ USUARIO NO ENCONTRADO

El usuario mencionado (@51999888777) no estÃ¡ registrado en la base de datos.

Posibles razones:
â€¢ Nunca ha enviado mensajes
â€¢ No es miembro del grupo
â€¢ NÃºmero incorrecto

ğŸ’¡ Verifica el nÃºmero e intenta nuevamente
```

**Alias del comando:**
```
Usuario: .perfil @usuario
Usuario: .ver @usuario
Usuario: .check @usuario
```

---

## Comandos EconÃ³micos

### 7. `.deposit <cantidad>` - Depositar Dinero en Banco

**Contexto:** Usuario quiere proteger su dinero guardÃ¡ndolo en el banco.

**Entrada del Usuario:**
```
Diego: .deposit 10.50
```

**Respuesta del Bot:**
```
ğŸ’³ DEPÃ“SITO EXITOSO

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’µ Cantidad depositada: $10.50
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š MOVIMIENTO BANCARIO:
ğŸ¦ Banco: $87.30 â†’ $97.80
ğŸ’° Efectivo: $12.45 â†’ $1.95

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’ Patrimonio Total: $99.75
âœ… Tu dinero estÃ¡ protegido y no puede ser robado.

ğŸ’¡ Usa .withdraw <cantidad> para retirar cuando lo necesites
```

**Caso - Depositar TODO:**
```
Diego: .dep all

Respuesta:
ğŸ’³ DEPÃ“SITO COMPLETO

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’µ Cantidad depositada: $12.45
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š MOVIMIENTO BANCARIO:
ğŸ¦ Banco: $87.30 â†’ $99.75
ğŸ’° Efectivo: $12.45 â†’ $0.00

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’ Patrimonio Total: $99.75
âœ… Todo tu dinero estÃ¡ protegido.

âš ï¸ Sin efectivo, no podrÃ¡s:
â€¢ Jugar en el casino
â€¢ Ser robado (ventaja)
```

**Caso - Depositar mÃ¡s de lo que tiene:**
```
Diego: .deposit 50.00

Respuesta:
âŒ FONDOS INSUFICIENTES

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Intentaste depositar: $50.00
ğŸ’° Tu efectivo actual: $12.45
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âŒ No tienes suficiente dinero en efectivo.

ğŸ’¡ Puedes depositar mÃ¡ximo: $12.45
ğŸ’¡ Usa: .deposit all para depositar todo
```

**Caso - Sin efectivo:**
```
Diego: .deposit 5.00

Respuesta:
âŒ SIN EFECTIVO

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’° Tu efectivo actual: $0.00
ğŸ¦ Tu banco actual: $99.75
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

No tienes dinero en efectivo para depositar.

ğŸ’¡ Tu dinero ya estÃ¡ seguro en el banco.
```

**Alias del comando:**
```
Usuario: .depositar 10
Usuario: .dep 10
Usuario: .dep all
Usuario: .depositar todo
Usuario: .guardar 10
```

---

### 8. `.withdraw <cantidad>` - Retirar Dinero del Banco

**Contexto:** Usuario necesita efectivo para jugar o hacer transacciones.

**Entrada del Usuario:**
```
Diego: .withdraw 20.00
```

**Respuesta del Bot:**
```
ğŸ§ RETIRO EXITOSO

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’µ Cantidad retirada: $20.00
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š MOVIMIENTO BANCARIO:
ğŸ¦ Banco: $97.80 â†’ $77.80
ğŸ’° Efectivo: $1.95 â†’ $21.95

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’ Patrimonio Total: $99.75

âš ï¸ ADVERTENCIA:
El efectivo puede ser robado por otros usuarios.
ğŸ’¡ Usa .deposit para volver a guardarlo cuando termines.
```

**Caso - Retirar TODO:**
```
Diego: .withdraw all

Respuesta:
ğŸ§ RETIRO COMPLETO

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’µ Cantidad retirada: $97.80
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š MOVIMIENTO BANCARIO:
ğŸ¦ Banco: $97.80 â†’ $0.00
ğŸ’° Efectivo: $1.95 â†’ $99.75

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’ Patrimonio Total: $99.75

âš ï¸ RIESGO ALTO:
Todo tu dinero estÃ¡ en efectivo y vulnerable a robos.

ğŸ’¡ Deposita lo que no uses con .deposit <cantidad>
```

**Caso - Intentar retirar mÃ¡s de lo que tiene:**
```
Diego: .withdraw 150.00

Respuesta:
âŒ FONDOS INSUFICIENTES

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Intentaste retirar: $150.00
ğŸ¦ Tu banco actual: $97.80
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âŒ No tienes suficiente dinero en el banco.

ğŸ’¡ Puedes retirar mÃ¡ximo: $97.80
ğŸ’¡ Usa: .withdraw all para retirar todo
```

**Caso - Sin dinero en banco:**
```
Diego: .withdraw 10.00

Respuesta:
âŒ BANCO VACÃO

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¦ Tu banco actual: $0.00
ğŸ’° Tu efectivo actual: $12.45
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

No tienes dinero en el banco para retirar.

ğŸ’¡ Tu dinero ya estÃ¡ disponible en efectivo.
ğŸ’¡ EnvÃ­a mensajes para ganar mÃ¡s dinero.
```

**Alias del comando:**
```
Usuario: .retirar 20
Usuario: .sacar 20
Usuario: .withdraw all
Usuario: .retirar todo
```

---

## Sistema de Robos

### 9. `.rob @usuario` - Intentar Robar Dinero

**Contexto:** Usuario nivel 2+ intenta robar efectivo de otro usuario.

**Caso 1: Robo Exitoso - Cantidad Baja (1-10%)**
```
LadrÃ³n: .rob @51987654321

[Sistema calcula]
- VÃ­ctima tiene: $15.00 en wallet
- Probabilidad: 30% â†’ Ã‰xito âœ“
- Cantidad robada: $1.20 (8%)

Respuesta:
ğŸ¥· ROBO CASI FRUSTRADO

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Robaste $1.20 (8%) a @Diego
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’° TU EFECTIVO:
$5.00 â†’ $6.20

ğŸ˜° Â¡ESE FUE UN ROBO NOVATO!
Por poco te atrapan. La prÃ³xima podrÃ­as no tener tanta suerte.

ğŸ’¡ @Diego deposita tu dinero con .deposit
```

**Caso 2: Robo Exitoso - Cantidad Media (20-50%)**
```
LadrÃ³n: .rob @51987654321

[Sistema]
- VÃ­ctima: $15.00
- Robado: $5.25 (35%)

Respuesta:
ğŸ’° BUEN ROBO

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Robaste $5.25 (35%) a @Diego
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’µ TU EFECTIVO:
$5.00 â†’ $10.25

ğŸ‘ Robo decente, nada mal.
Has demostrado habilidad.

ğŸ’¡ Deposita tus ganancias con .deposit
```

**Caso 3: Robo Exitoso - Cantidad Alta (50-90%)**
```
LadrÃ³n: .rob @51987654321

[Sistema]
- VÃ­ctima: $15.00
- Robado: $11.25 (75%)

Respuesta:
ğŸ’ Â¡ROBO ESPECTACULAR!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Robaste $11.25 (75%) a @Diego
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’° TU EFECTIVO:
$5.00 â†’ $16.25

ğŸ”¥ Â¡ROBO MAESTRO!
Has dejado a tu vÃ­ctima casi en la ruina.

âš ï¸ @Diego: Te robaron casi todo tu efectivo!
ğŸ’¡ Protege tu dinero con .deposit
```

**Caso 4: Robo PERFECTO (100%)**
```
LadrÃ³n: .rob @51987654321

[Sistema]
- VÃ­ctima: $15.00
- Robado: $15.00 (100%)

Respuesta:
ğŸ‰ Â¡Â¡Â¡ROBO PERFECTO!!!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’ ERES UN MAESTRO DEL CRIMEN ğŸ’
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Robaste $15.00 (100%) a @Diego

ğŸ’€ DEJASTE EN BANCA ROTA A @Diego

ğŸ’° TU EFECTIVO:
$5.00 â†’ $20.00

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ† ROBO LEGENDARIO
Has robado TODO el efectivo de tu vÃ­ctima.
Eres una leyenda del crimen.

âš ï¸ @Diego: Fuiste vÃ­ctima de un robo perfecto!
Tu efectivo: $15.00 â†’ $0.00
ğŸ’¡ Recupera dinero enviando mensajes.
```

**Caso 5: Robo Fallido - Multa Pagable**
```
LadrÃ³n: .rob @51987654321

[Sistema]
- Probabilidad: 50% â†’ Fallo âŒ
- Multa: $3.00
- LadrÃ³n tiene: wallet $2.00, bank $8.00

Respuesta:
ğŸš¨ ROBO FALLIDO

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âŒ TE ATRAPÃ“ LA POLICÃA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’¸ Multa: $3.00 pagados a @Diego por daÃ±os y perjuicios

ğŸ“Š INTERVENCIÃ“N FINANCIERA:
Tu efectivo: $2.00 â†’ $0.00
Tu banco: $8.00 â†’ $7.00

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âš–ï¸ Se tomÃ³ dinero de tu efectivo y banco.

âœ… @Diego recibiÃ³ $3.00 como compensaciÃ³n:
Efectivo: $15.00 â†’ $18.00
```

**Caso 6: Robo Fallido - Deuda Generada**
```
LadrÃ³n: .rob @51987654321

[Sistema]
- Multa: $12.00
- LadrÃ³n tiene: wallet $1.50, bank $4.00
- Total disponible: $5.50
- Deuda generada: -$6.50

Respuesta:
ğŸš¨ ROBO FALLIDO - DEUDA GENERADA

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âŒ TE ATRAPÃ“ LA POLICÃA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’¸ Multa total: $12.00 a @Diego

ğŸ“Š INTERVENCIÃ“N BANCARIA COMPLETA:
Tu efectivo: $1.50 â†’ $0.00
Tu banco: $4.00 â†’ $0.00
ğŸ’³ Deuda pendiente: -$6.50

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âš ï¸ NO PUDISTE PAGAR LA MULTA COMPLETA

ğŸ”’ CONSECUENCIAS:
â€¢ Tus prÃ³ximos mensajes pagarÃ¡n esta deuda
â€¢ No recibirÃ¡s dinero hasta saldar: $6.50
â€¢ Cada mensaje pagarÃ¡ $0.01 de tu deuda

âœ… @Diego recibiÃ³ $5.50 (resto pendiente de pago)
Efectivo: $15.00 â†’ $20.50

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’¡ EnvÃ­a 650 mensajes para pagar tu deuda completa.
```

**Caso 7: VÃ­ctima Sin Dinero**
```
LadrÃ³n: .rob @51912345678

[Sistema]
- VÃ­ctima wallet: $0.00

Respuesta:
ğŸ’¼ VÃCTIMA SIN EFECTIVO

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
@Carlos no tiene dinero en efectivo.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

No hay nada que robar.

ğŸ’¡ Solo puedes robar dinero en efectivo (wallet).
El dinero en banco estÃ¡ protegido.
```

**Caso 8: LadrÃ³n Sin Permisos (Nivel 1)**
```
UsuarioNivel1: .rob @51987654321

Respuesta:
âŒ NIVEL INSUFICIENTE
....